<!doctype html>
<html>
<head><meta charset="utf-8"><title></title><link rel="stylesheet" href="../../../help.css"></head>
<body><h2><a name="Configuring_DCOM"></a>Configuring an <span class="Italic">out-of-process</span> OLEServer for DCOM</h2><h4><a name="Introduction"></a>Introduction</h4><p>When you register an <span class="Italic">out-of-process</span> OLEServer using <span class="Italic">File/Export</span> or OLERegister, Dyalog APL automatically updates the Windows registry so that your OLEServer is immediately accessible to an OLE client application running on <span class="Italic">the same</span> computer.</p><p>If you wish to make the same object accessible to client applications running on <span class="Italic">different</span> computers (using distributed COM, or DCOM) you have to install additional registry entries on the server and on each of the clients.</p><p>Once you have established these registries entries, you should be able to access the OLEServer from Windows 95 or NT client computers in exactly the same way as if it were local; the client applications need not know where the server is located. In most cases, these additional registry entries are sufficient. However, the NT and DCOM security considerations may require the use of <span class="Code">dcomcnfg.exe</span> (a Microsoft utility) to set additional values. For example, if you get <span class="Code">E_ACCESSDENIED</span> errors when connecting from the client you may need to run <span class="Code">dcomcnfg.exe</span> on the server computer to assign the appropriate launch and access permissions for the OLEServer object.</p><p>The additional registry entries are described below. You may add these to the registry directly (using <span class="Code">regedit.exe</span>) or by running the functions provided in the <span class="Code">DCOMREG.DWS</span> workspace.</p><h4><a name="DCOM_Registry_Server"></a>DCOM Registry Entries for the Server</h4><p>On the computer upon which you want the OLEServer to be run, you must add the following registry entries.</p><ol><li value="1">A key under HKEY_CLASSES_ROOT\AppID whose name corresponds to the CLSID of your OLEServer object as reported by the value of its <tt>ClassID</tt> property. The <span class="Italic">(Default)</span> value of this key should be the name of the server object. In addition, you must define a <span class="Italic">RunAs</span> entry which specifies the manner in which a client application runs your server. The simplest choice is <span class="Italic">Interactive User</span> which specifies that the client application is treated like a normal user.</li><p class="NoIndent">For example, if you had saved an OLEServer namespace called <tt>Loan</tt> (c.f. <span class="Code">samples\loan.dws</span>), whose <tt>ClassID</tt> property had the value {B80E9D40-2090-11D1-8F93-0020AFABD95D} the entries would be:</p><p class="NoIndent">HKEY_CLASSES_ROOT\AppID\{B80E9D40-2090-11D1-8F93-0020AFABD95D}</p><p class="NoIndent">(Default)=dyalog.Loan</p><p class="NoIndent">RunAs=Interactive User</p></ol><ol start="2"><li value="2">An AppID entry to the HKEY_CLASSES_ROOT<b>\</b>CLSID key. (Note that this key will itself have been created by Dyalog APL/W when you saved the workspace) Once again, CLSID refers to the value of your OLEServer’s <tt>ClassID</tt> property. The value of the AppID entry is the (same) CLSID.</li><p class="NoIndent">Using the same example as above, the entry would be:</p><p class="NoIndent">HKEY_CLASSES_ROOT\{B80E9D40-2090-11D1-8F93-0020AFABD95D}</p><p class="NoIndent">AppID={B80E9D40-2090-11D1-8F93-0020AFABD95D}</p></ol><h4><a name="DCOM_Registry_Client"></a>DCOM Registry Entries for the Client</h4><p>On each of the computers from which you wish to call the OLEServer object as a client, you must add the following entries.</p><ol><li value="1">Two keys under HKEY_CLASSES_ROOT that identify the object (locally) and associate it with your OLEServer Note that the local name of the object is arbitrary and may be different on each client.</li><p class="NoIndent">HKEY_CLASSES_ROOT\dyalog.ServerName</p><p class="NoIndent">HKEY_CLASSES_ROOT\dyalog.ServerName\CLSID</p><p class="NoIndent">CLSID is again the CLSID of the OLEServer object (this <b>must</b> be the same as that of the server machine). dyalog.ServerName can be replaced with whatever name you want clients to use to refer to this object</p></ol><ol start="2"><li value="2">Under HKEY_CLASSES_ROOT\AppID, a key whose name corresponds to the CLSID of your server object. The <span class="Italic">(Default)</span> value of this key should be the name of the OLE server object (its name on the server computer). In addition, the key should contain a <span class="Italic">RemoteServerName</span> entry whose value is the name of the server computer. For example:</li><p class="NoIndent">HKEY_CLASSES_ROOT\AppID\{B80E9D40-2090-11D1-8F93-0020AFABD95D}</p><p class="NoIndent">(Default)=dyalog.Loan</p><p class="NoIndent">RemoteServerName=ntsvr</p></ol><h4><a name="DCOMREG_Workspace"></a>DCOMREG Workspace</h4><p>The workspace DCOMREG.DWS contains a single namespace called <tt>reg</tt> that contains three functions to help register an <span class="Italic">out-of-process</span> OLE Server for DCOM.</p><h4>RegDCOMServer</h4><p>This function should be run on the <span class="Italic">server</span> computer and is called as follows:</p><pre>      RegDCOMServer ServerName CLSID</pre><p>Where <tt>ServerName</tt> is a character string containing the (full) name of the OLEServer (e.g. <tt>dyalog.Loan</tt>) and <tt>CLSID</tt> is a character string containing the CLSID of the server (the value of it <tt>ClassID</tt> property). For example:</p><pre>      )LOAD LOAN
.\LOAN saved ...
      )COPY DCOMREG
DCOMREG saved ...
 
      CLSID ←('Loan' ⎕WG 'ClassID')
      reg.RegDCOMServer 'dyalog.Loan' CLSID</pre><h4>RegDCOMClient</h4><p>This function should be run on each of the <span class="Italic">client</span> computers and is called as follows:</p><pre>      machine RegDCOMClient ServerName CLSID</pre><p>Where <tt>machine</tt> is a character vector specifying the name of the (NT) server computer, <tt>ServerName</tt> is a character vector containing the (full) name of the OLEServer (e.g. <tt>dyalog.Loan</tt>) and <tt>CLSID</tt> is a character string containing the CLSID of the server (the value of it <tt>ClassID</tt> property). For example:</p><pre>      CLSID←'{B80E9D40-2090-11D1-8F93-0020AFABD95D}'
      'NTSVR' reg.RegDCOMClient 'dyalog.Loan' CLSID</pre><h4>Config</h4><p>This niladic function simply invokes the <span class="Code">dcomcnfg.exe</span> utility using <tt>⎕CMD</tt>.</p></body>
</html>