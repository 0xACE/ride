<!doctype html>
<html>
<head><meta charset="utf-8"><title></title><link rel="stylesheet" href="../../../help.css"></head>
<body><h2><a name="Docking_ToolControl"></a>Docking and Undocking a ToolControl</h2><p>Docking and undocking a ToolControl is handled rather differently from docking and undocking a Form or CoolBand.</p><p>When you undock a ToolControl from a Form or SubForm, it cannot remain a ToolControl object, because a ToolControl cannot be a child of Root. Furthermore, its Type cannot simply change to Form because a Form cannot be a parent of a ToolButton. In fact, a ToolButton may <b>only</b> be the child of a ToolControl.</p><p>Therefore, when a dockable ToolControl is undocked, no action is taken; you have to perform the various operations yourself.</p><p>Typically, you would create a new Form to contain the ToolControl and only the ToolControl), and then delete the original.</p><p>The new Form should be dockable in the original parent (of the ToolControl), but a callback should intercept this operation and re-instate the ToolControl as a direct child of the host.</p><p>Effectively, when you undock a ToolControl, you need to insert a new (floating) Form between the Host Form and the ToolControl. Then when you re-dock it, you need to remove the (floating) Form from the hierarchy.</p><p>The following example illustrates the procedure.</p><p>The following function creates a Form containing a dockable ToolControl. The ToolControl can be undocked, becoming a floating toolbar, and then docked back into the original Form.</p><pre>     ∇ DockableToolControl
[1]    'IL'⎕WC'ImageList'('Masked' 0)
[2]    'IL.'⎕WC'Bitmap'('ComCtl32' 120)⍝ STD_SMALL
[3]    :With 'Host'⎕WC'Form' 'Host'
[4]        Coord←'Pixel'
[5]        Size←50 300
[6]        DockChildren←'Floater'
[7]        onDockAccept←'#.DOCK'
[8]        onDockMove←'#.DOCKMOVE'
[9]        :With 'TC'⎕WC'ToolControl'
[10]           Dockable←'Always'
[11]           onDockRequest←'#.UNDOCK'
[12]           ImageListObj←'#.IL'
[13]           'B1'⎕WC'ToolButton' 'New'('ImageIndex' 7)
[14]           'B2'⎕WC'ToolButton' 'Open'('ImageIndex' 8)
[15]           'B3'⎕WC'ToolButton' 'Save'('ImageIndex' 9)
[16]       :EndWith
[17]   :EndWith
     ∇</pre><p>The picture below shows the initial appearance of the <tt>Host</tt> Form and its ToolControl.</p><p><img src="../images/docking-toolcontrol-0.png" /></p><p>Because the ToolControl is dockable, the user may pick it up and drag it out of its parent Form as shown below.</p><p><img src="../images/docking-toolcontrol-1.png" /></p><p>When the user drops the ToolControl outside the <tt>Host</tt> Form, it (the ToolControl) generates a DockRequest event which is attached to the <tt>UNDOCK</tt> callback function. This function, creates a new Form called <tt>Floater</tt>, makes a copy of the ToolControl as a child of <tt>Floater</tt>, and then expunges the original ToolControl from the <tt>Host</tt> Form. The function, and the results of the operation, are shown below. The following points should be noted.</p><ul><li value="1">The <tt>UNDOCK</tt> callback returns 0 to prevent APL from taking any further action (the default action after a successful DockRequest is to generate a DockAccept event, which in this case is undesirable).</li><li value="2">The <tt>Floater</tt> Form is created as a child of the <tt>Host</tt> Form so that it always floats above it in the window stacking order.</li><li value="3">The <tt>Floater</tt> Form is made dockable so that it can be re-docked back into <tt>Host</tt>.</li><li value="4">The (new) ToolControl is made non-dockable, so that the user cannot drag it out of <tt>Floater</tt>.</li></ul><p class="pagebreakafter"> </p><pre>     ∇ R←UNDOCK MSG
[1]    R←0
[2]    :With 'Host.Floater'⎕WC'Form'
[3]        Caption←'Floating ToolControl'
[4]        Dockable←'Always'
[5]        Coord←'Pixel'
[6]        'TC'⎕WC⊃MSG
[7]        TC.Dockable←'Never'
[8]        Size←TC.Size
[9]        Posn←#.Host.Posn+2↑7⊃MSG
[10]   :EndWith
[11]   ⎕EX'#.Host.TC'
     ∇</pre><p><img src="../images/docking-toolcontrol-2.png" /></p><p><img src="../images/docking-toolcontrol-3.png" /></p><p>The user may dock the ToolControl back into Host by dragging the <tt>Floater</tt> Form into it.</p><p>The <tt>DOCKMOVE</tt> callback function, shown below, prevents the ToolControl (represented by its parent <tt>Floater</tt>) from being docked anywhere except along the top edge.</p><pre>     ∇ R←DOCKMOVE MSG
[1]   ⍝ Only allow docking along Top edge
[2]    R←MSG[4]∊'Top' 'None'
     ∇</pre><p>The picture below illustrates the moment just before the user releases the mouse button to dock Floater back into Host.</p><p><img src="../images/docking-toolcontrol-4.png" /></p><p>At this point, the <tt>Host</tt> Form generates a DockAccept event and the callback function <tt>DOCK</tt> is invoked. This function recreates the ToolControl as a child of <tt>Host</tt> (making it dockable once more), and then expunges the <tt>Floater</tt> Form.</p><pre>     ∇ R←DOCK MSG
[1]    R←0
[2]    :With ⊃MSG
[3]        'TC'⎕WC ⎕OR(3⊃MSG).TC
[4]        TC.Dockable←'Always'
[5]    :EndWith
[6]    ⎕EX'#.Host.Floater'
     ∇</pre><p>Once again, the result of the callback function is 0 to tell APL that you have dealt with the situation and it is to take no further action.</p><p><img src="../images/docking-toolcontrol-0.png" /></p><script src="../../../help.js"></script></body>
</html>