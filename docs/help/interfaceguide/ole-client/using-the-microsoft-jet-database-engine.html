<!doctype html>
<html>
<head><meta charset="utf-8"><title></title><link rel="stylesheet" href="../../../help.css"></head>
<body><h2><a name="Jet_Database_Engine"></a>Using the Microsoft Jet Database Engine</h2><p>The SQL function in workspace <span class="Code">samples\ole\oleauto.dws</span> is a simple example showing how you can call the Microsoft Jet database engine using OLE.</p><p>SQL is dyadic. The left argument is the path-name of an Access database; the right argument is a query in the form of an SQL statement.</p><p>The result is a matrix containing the records that match the query.</p><p>For example:</p><pre>      FILE← 'c:\Program Files\Microsoft Office\Office\Samples\Northwind'
      QUERY←'Select * From Suppliers'
     ⍴FILE SQL QUERY
29 11</pre><h4>The SQL Function</h4><pre>     ∇ DATA←DATABASE SQL QUERY;DB;DBS;RCS
[1]   ⍝ Uses the OLE Server DAO.DBEngine to perform a
[2]   ⍝ query on an MS Access database
[3]
[4]    'DB'⎕WC'OleClient' 'DAO.DBEngine.35'
[5]
[6]    :Trap 11 ERROR
[7]        DBS←DB.OpenDatabase⊂DATABASE
[8]        RCS←DBS.OpenRecordset⊂QUERY
[9]        DATA←⍉RCS.GetRows 999
[10]   :Else
[11]       DATA←'DB'⎕WG'LastError'
[12]   :EndTrap
     ∇</pre><p>Let us examine how the function works.</p><pre>   [4]   'DB'⎕WC'OleClient' 'DAO.DBEngine.35'</pre><p>This statement creates a new namespace called <tt>DB</tt> that is connected to the DAO.DBEngine OLE Server. After the statement has executed, <tt>DB</tt> is essentially an instance of the object and exposes the methods and properties provided by the object.</p><pre>   [7]   DBS←DB.OpenDatabase⊂DATABASE</pre><p>The <tt>OpenDatabase</tt> method is called with the name of the database file as its single argument (other parameters are optional and omitted here). The result of <tt>OpenDatabase</tt> is a (new) Database object whose namespace reference is assigned to <tt>DBS</tt>.</p><pre>   [8]   RCS←DBS.OpenRecordset QUERY</pre><p>The <tt>OpenRecordset</tt> method is called with a character vector containing an SQL statement as its argument. The result of <tt>OpenRecordset</tt> is a (new) Recordset object whose namespace reference is assigned to <tt>RCS</tt>.</p><pre>   [9]   DATA←⍉RCS.GetRows 999</pre><p>The <tt>GetRows</tt> method takes a single parameter which is the number of rows to be fetched. This simple example ignores the possibility that there may be more than 999 records to be fetched and ignores the possibility of <tt>WS FULL</tt>. The result is a nested matrix containing the data. In this case, the data is transposed.</p><p>It is not actually necessary to assign the results of the expressions in lines [7] and [8]. These expressions, which return namespaces, can simply be parenthesised and the entire query can be executed in a single statement as illustrated by function <tt>SQL1</tt>.</p><pre>      ∇ DATA←DATABASE SQL1 QUERY;DB
[1]   ⍝ Shorter version of SQL
[2]
[3]    'DB'⎕WC'OleClient' 'DAO.DBEngine.35'
[4]
[5]    :Trap 11
[6]        DATA←⍉((DB.OpenDatabase⊂DATABASE).
   OpenRecordset⊂QUERY).GetRows 999
[7]    :Else
[8]        DATA←DB.LastError
[9]    :EndTrap
     ∇</pre><script src="../../../help.js"></script></body>
</html>