<!doctype html>
<html>
<head><meta charset="utf-8"><title></title><link rel="stylesheet" href="../../../../help.css"></head>
<body><h4>Example 1</h4><p>This example illustrates data binding using XAML to specify the user-interface coupled with an APL function to drive it and handle the data binding.</p><p><img src="../../images/data-binding-text-xaml-1.png" /></p><h4>The XAML</h4><p> The XAML shown below, describes a Window containing a TextBox.</p><pre class="Code">&lt;Window
 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
 Name="Temp"
 Title="Data Binding (Text)"
 SizeToContent="WidthandHeight"&gt;
     &lt;TextBox Name="txt" Width="300" Margin="5"
      Text="{Binding txtSource,Mode=TwoWay,
             UpdateSourceTrigger=PropertyChanged}"/&gt;
&lt;/Window&gt;</pre><p>It contains a data binding expressions, namely:</p><pre class="Code">      Text="{Binding txtSource,Mode=TwoWay,
             UpdateSourceTrigger=PropertyChanged}"</pre><p>This specifies that the <span class="Member">Text</span> property of the <span class="NetType">TextBox</span> is bound to a value in the Binding Source (which has yet to be defined) whose path is <span class="Code">txtSource</span>. The binding mode is set to <span class="Code">TwoWay</span> which means that any change in the <span class="NetType">TextBox</span> will be reflected in a new value in the Binding Source, and vice-versa. The value in the Binding Source will be updated when the property (in this case the <span class="Member">Text</span> Property) changes.</p><h4 class="ExampleNewPage">The APL Code</h4><p> Th function <tt>Text</tt> which generates this example is shown below.</p><p>The argument <tt>txt</tt> is the text to be displayed initially in the <span class="NetType">TextBox</span>. Note that the variable <tt>XAML_Text</tt> contains the XAML that describes the user-interface listed above.</p><pre>     ∇ Text txt;⎕USING;str;xml;win
[1]    ⎕USING←,⊂'System.Windows.Controls,WPF/PresentationFramework.dll'
[2]    win←LoadXAML XAML
[3]    win.txtBox←win.FindName⊂'txt'
[4]
[5]    ⎕EX'txtSource'
[6]    txtSource←txt
[7]    win.txtBox.DataContext←2015⌶'txtSource'
[8]
[9]    win.Show
     ∇
</pre><p>The utility function <tt>LoadXAML</tt> incorporates the 3 lines of code, used to create a WPF window from XAML, that were coded in-line in previous examples in this chapter.</p><pre>     ∇ win←LoadXAML xaml;⎕USING;str;xml
[1]    ⎕USING←'System.IO'
[2]    ⎕USING,←⊂'System.Windows.Markup'
[3]    ⎕USING,←⊂'System.Xml,system.xml.dll'
[4]    ⎕USING,←⊂'System.Windows.Controls,
                 WPF/PresentationFramework.dll'
[5]    str←⎕NEW StringReader(⊂xaml)
[6]    xml←⎕NEW XmlTextReader str
[7]    win←XamlReader.Load xml
     ∇
</pre><p><tt>Text[1]</tt> defines the .Net search path needed to access the WPF controls.</p><pre>
[1]    ⎕USING←,⊂'System.Windows.Controls,WPF/PresentationFramework.dll'</pre><p><tt>Text[2-3]</tt> uses the utility function<tt> LoadXAML</tt> to load a WPF user-interface from the XAML and then uses the <span class="Member">FindName</span> method to obtain a reference to the object named <span class="Name">txt</span>.</p><pre>
[2]    win←LoadXAML XAML
[3]    win.txtBox←win.FindName⊂'txt'</pre><p><tt>Text[5-6]</tt> initialise a new global variable named <tt>txtSource</tt> to the value of the argument. When using a <span class="Italic">global</span> variable as a data binding source, it is generally advisable to establish a new variable by first expunging it.<span class="MCTextPopup"><span class="MCTextPopupBody_0" style="display: none; "> This is because its binding type (the exported type of the data bound variable) is stored in the workspace along with its value, and the binding type (were it to be incorrect) may not  be changed once it has been established.</span><a href="javascript:void(0);" class="MCTextPopupSpot_0" onclick="FMCTextPopup( event, this ); return false;" style="font-size: 0.9em; vertical-align: super">1</a></span></p><pre>
[5]   ⎕EX'txtSource'
[6]   txtSource←txt</pre><p><tt>Text[7]</tt>creates a Binding Source object using <tt>2015⌶</tt> and assigns it to the <span class="Member">DataContext</span> property of the <span class="NetType">TextBox</span> object. Because it is a character vector, the exported Type for the bound variable<tt> txtSource</tt> is <span class="NetType">System.String</span> which is appropiate for the <span class="Member">Text</span> property of a <span class="NetType">TextBox</span>.</p><pre>
[7]    win.txtBox.DataContext←2015⌶'txtSource'</pre><p><tt>Text[9]</tt> displays the Window. Note that although the APL local variable <tt>win</tt> goes out of scope when the function terminates, the Window remains visible until the user has closed it.</p><pre>
[9]   win.Show</pre><h4>Testing the Data Binding</h4><p>The following expressions may be used to explore the effect of data binding.</p><pre>      )LOAD WPFIntro
      )CS DataBinding.Text</pre><pre>      Text 'Hello World'</pre><p><img src="../../images/data-binding-text-xaml-1.png" /></p><pre>     txtSource←⌽txtSource</pre><p><img src="../../images/data-binding-text-xaml-2.png" /></p><p>Typing into the TextBox changes the value of the bound variable.</p><p><img src="../../images/data-binding-text-xaml-3.png" /></p><pre>      txtSource
What is in txtSource now?
</pre><script src="../../../../help.js"></script></body>
</html>