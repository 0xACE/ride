<!doctype html>
<html>
<head><meta charset="utf-8"><title></title><link rel="stylesheet" href="../../help.css"></head>
<body><h2 class="Newpage"><tt>⎕SH</tt>, exit codes and stderr</h2><p>Note that <tt>⎕SH</tt>calls /bin/sh; this cannot be altered.
        </p><p>If the command, or command pipe issued using <tt>⎕SH</tt> exits with a non-zero exit code, then <tt>⎕SH</tt> will terminate with a <tt>DOMAIN ERROR</tt>, and all output from the command will be lost. To avoid this, add an exit 0 to the end of the command string, and the <tt>DOMAIN ERROR</tt> will be suppressed. However, this technique does require that some other method is used to determine that the command pipe failed.
        Example:</p><pre>      ⍴⎕SH 'grep no_such_user /etc/passwd'
DOMAIN ERROR
      ⍴⎕SH 'grep no_such_user /etc/passwd'
     ∧</pre><p>but</p><pre>      ⍴⎕SH 'grep no_such_user /etc/passwd ; exit 0'
0</pre><p><tt>⎕SH</tt> only captures stdout; unless redirected, any output on stderr will appear in the same terminal window as the session; hitting RD (default Ctrl-L) will force a screen redraw, thereby returning the session to its state before the error output appeared.
        </p><h3><tt>⎕SH</tt> and starting jobs in background</h3><p>It is possible to run tasks from within APL using <tt>⎕SH</tt>:
        </p><pre>      ⎕sh'myjob'</pre><p>However, in this case, APL will wait until myjob has completed, and will return the output from myjob (assuming that is that myjob completes with a non-zero exit code). It is possible to start a job that will run in background, without APL waiting for that job to complete, with the job continuing even if APL is terminated:</p><p>Example:</p><pre>      ⎕sh 'sleep 40000 &lt;/dev/null &gt;/dev/null 2&gt;&amp;1 &amp;'</pre><p>More useful might be to save the stdout and stderr of the command, and pipe the input in from a file; it might also be useful to have the job continue to run even after the user has both quit APL and logs out from the server:</p><pre>      ⎕sh 'nohup myjob &lt;my.in &gt;my.out 2&gt;my.err &amp;'</pre></body>
</html>