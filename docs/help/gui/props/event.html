<!doctype html>
<html>
<head><meta charset="utf-8"><title></title><link rel="stylesheet" href="../../../help.css"></head>
<body><h2><tt>Property</tt>Event</h2><p class="Bold"><span class="MCPopup"><a href="javascript:void(0);" onclick="FMCPopup( event, this ); return false;" class="MCPopupSpot">Applies To</a></span></p><p class="Bold">Description</p><p>This property defines how an object responds to user actions. Unlike other
properties which only have a single value, this property has a value
corresponding to each of the events that may be generated by a particular
object. Each event setting is specified by a 2 or 3-element vector containing :</p><table><tr><td><tt>[1]</tt></td><td>event name(s) (optionally prefixed by the string <tt>'on'</tt>)
      or event number(s) (numeric scalar or vector).</td></tr><tr><td><tt>[2]</tt></td><td>action code (numeric scalar or character vector) <table cellspacing="1" cellpadding="3" border="0"><tr><td class="DyalogPlain">¯1</td><td>inhibit (ignore) event</td></tr><tr><td class="DyalogPlain">0</td><td>handle event, do not report to APL</td></tr><tr><td class="DyalogPlain">1</td><td>handle event, then report to APL</td></tr><tr><td class="DyalogPlain">fn</td><td>name of callback function</td></tr><tr><td class="DyalogPlain">fn&amp;</td><td>name of callback function to be executed<span class="Italic">asynchronously</span></td></tr><tr><td class="DyalogPlain">⍎expr</td><td>expression to be executed</td></tr></table></td></tr><tr><td><tt>[3]</tt></td><td>any array (optional)</td></tr></table><p>The event number 0 and the event name <tt>'All'</tt>,
apply to all events supported by that object.</p><p>Like any other property, the Event property can be set using assignment.
However, certain special considerations apply which are discussed later.</p><p>If <span class="Italic">action</span> is set to <tt>¯1</tt>, the
event is ignored by APL. If, for example, you set the action on a KeyPress event
to <tt>¯1</tt>, all keystrokes for the object in
question will be ignored. Similarly, if you set the <span class="Italic">action</span> on a Close
event for a Form to <tt>¯1</tt>, the user will be
unable to close the Form. This is possible because APL intercepts most events
before Windows itself takes any action. However, certain events (e.g. focus
change events) are not notified to APL until <b>after</b> the event has occurred
and <b>after</b> Windows has itself responded in some way. In these
circumstances it is not always practical for APL to undo what Windows has
already done, and an action code of <tt>¯1</tt> is
treated as if it were 0. For further details, see the individual entries for
each event type in this Chapter.</p><p>If action code is set to 0 (the default), the event is processed by APL and
Windows in the normal way (this is referred to herein as "default
processing") but your program is not notified in any way that the event has
occurred. For example, the default processing for a keystroke is to action it
(via the translate table) and either echo a character in the object or perform
some other appropriate function.</p><p>If action code is set to 1, the event is first processed by APL (and Windows)
in the normal way, then <tt>⎕DQ</tt> terminates,
returning an <b>event message</b> as its result. The format of the event message
is given under the description of each event type.</p><p>If action code is set to a character vector that specifies the name of a
function, this function (termed a "callback") will be executed
automatically by <tt>⎕DQ</tt> whenever the event
occurs. Default processing of the event is deferred until after the callback has
been run, and may be inhibited or modified by its result. If the callback
function returns no result, or returns a scalar 1, normal processing of the
event is allowed to continue as soon as the callback completes. If the callback
returns a scalar 0, normal processing of the event is inhibited and the effect
is identical to setting the action code to <tt>¯1</tt>.
A callback function may also return an event message as its result. If so, <tt>⎕DQ</tt>will action <span class="Italic">this</span> event rather than the original one that fired the
callback.</p><p>Note that that if a callback function does not exist at the instant it is
invoked, <tt>⎕DQ</tt> terminates with a <tt>VALUE
ERROR</tt>. However, the name of the missing function is reported in
the Status Window.</p><p>If, in setting the Event property, the event name is prefixed by the string <tt>'on'</tt>,
for example, <tt>'onSelect'</tt>, the right
argument to the callback function will contain one or more object <span class="Italic">references</span>.
If not, it will contain the corresponding object <span class="Italic">names</span> or, if the object
has no name, its display form.</p><p>If the character &amp; is appended to the name of a callback function, the
callback is executed <b>asynchronously</b> in a new thread. In this case,
default processing of the event is performed immediately. Such a callback should
not return a result; if it does so, it will be treated as normal output and will
therefore be displayed in the Session window.</p><p>When a callback function is invoked by <tt>⎕DQ</tt>,
the corresponding event message is supplied as its right argument. The format of
the event message is given under the description of each event type in this
chapter. Note that the first element of the event message is always a <span class="Italic">reference
to</span> or the <span class="Italic">name of</span> the object that generated the event. It is a <span class="Italic">reference</span>if the event name was prefixed by the string <tt>'on'</tt>;
otherwise it is a character vector containing the object's name.</p><p>If an array was specified as the 4th element of the value of the Event
property, the value of this array is supplied as its left argument.</p><p>Notice that <tt>⎕DQ</tt> takes account of the
syntax defined for the callback, and supplies these arguments only if it is
appropriate to do so. It is possible therefore to use a niladic callback
function. This is appropriate if the callback can perform its task without
needing to interrogate the event message.</p><p>If action code is set to a character vector whose first element is the
execute symbol (<tt>⍎</tt>) the remaining string
will be executed automatically whenever the event occurs. The default processing
for the event is performed first and may not be changed or inhibited in any way.</p><p>Notice that when you specify the action to be taken on the occurrence an
event there is a great difference between <tt>'FOO'</tt>and <tt>'⍎FOO'</tt>. The former causes APL to
invoke the function <tt>FOO</tt> as a <span class="Italic">callback
function</span>. If the function takes an argument, APL will supply it with the
event message. Secondly, the result (if any) of the function <tt>FOO</tt>will be used by APL and may cause the event to be disabled or changed in some
way. In the second case, APL will perform the default processing for the event
and then execute <tt>FOO</tt> without supplying an
argument. If the function returns a result, it will be displayed in the Session.</p><p>When using <tt>⎕WC</tt> and <tt>⎕WS</tt>to assign different events to different callbacks, it is not necessary to repeat
the <tt>'Event'</tt> keyword. Instead, several
event settings can be specified at once. In any given occurrence of the Event
property you may use event number(s) or event name(s); however you may not mix
numbers and names together.</p><p>If you use event names, your callback functions will receive event names in
their right argument when invoked. That is to say that the second element of the
event message will be a character vector. If you use event numbers, the second
element of the event message will be numeric. If you want to specify several
event names at once, you must enclose them. If you use numbers, <tt>⎕WC</tt>and <tt>⎕WS</tt> are more tolerant about the <b>structure</b>of their arguments, and will accept many different expressions.</p><p>If no events are set, the result obtained by <tt>⎕WG</tt>and the result obtained by referencing Event directly are different:</p><pre>      'F'⎕WC'Form'
      DISPLAY 'F'⎕WG'Event'
.→--.
|0 0|
'~--'
      DISPLAY F.Event
.⊖------------.
| .→--------. |
| | .⊖. .⊖. | |
| | | | | | | |
| | '-' '-' | |
| '∊--------' |
'∊------------'</pre><h4>Asynchronous Callback Functions</h4><p>If you append the character &amp; to the name of the callback
function in the <tt>Event</tt> specification, the
callback function will be executed asynchronously in a new thread when the event
occurs. If not, it is execute synchronously.</p><p>For example, the event specification:</p><pre>      onSelect←'DoIt&amp;'</pre><p>tells <tt>⎕DQ</tt> to execute the callback
function <tt>DoIt</tt> asynchronously as a thread
when a Select event occurs on the object. Note that a callback function executed
in this way should not return a result (because <tt>⎕DQ</tt>does not wait for it) and any result will be displayed in the Session window.</p><h4>Specifying the Event property using Assignment</h4><p>There are two ways to specify the Event property using assignment; you can
specify the entire set of events, or you can set individual events one by one.</p><p>To specify the entire set of events, the array assigned to Event must contain
one or more nested vectors, each containing 2 or 3 elements as described above.
For example, if <tt>F1</tt> is a Form:</p><p>Invoke callback function <tt>FOO</tt> on
MouseDown, the first element of the right argument to <tt>FOO</tt>will contain a <span class="Italic">namespace reference</span> to <tt>F1</tt>.
All other events perform their default actions.</p><pre>      F1.Event ← 'onMouseDown' 'FOO'</pre><p>Invoke callback function <tt>FOO</tt> on
MouseDown, the first element of the right argument to <tt>FOO</tt> will contain the <span class="Italic">character vector</span><tt>'F1'</tt>.
All other events perform their default actions.</p><pre>      F1.Event ← 'MouseDown' 'FOO'</pre><p>Invoke callback function <tt>FOO</tt> on
MouseDown and MouseUp. All other events perform their default actions.</p><pre>      F1.Event ← ('onMouseDown' 'FOO')( 'onMouseUp' 'FOO')</pre><p>Add callback function <tt>FOO</tt> with <tt>('THIS'
1)</tt> as its left-argument on the MouseMove event. All other events
perform their default actions.</p><pre>      F1.Event, ← ⊂ 'onMouseMove' 'FOO' ('THIS' 1)</pre><p>To set individual events one by one, you make the assignment to the event
name prefixed by the string <tt>'on'</tt>. In all
cases, the first element of the right argument to <tt>FOO</tt>will contain a <span class="Italic">namespace reference</span> to <tt>F1</tt>.
You must use the <tt>'on'</tt> prefix; you cannot
assign to the Event name itself.</p><p>Invoke callback function <tt>FOO</tt> on
MouseDown.</p><pre>      F1.onMouseDown ← 'FOO'</pre><p>Add the same callback for MouseUp.</p><pre>      F1.onMouseUp ← 'FOO'</pre><p>Add callback function <tt>FOO</tt> with <tt>('THIS'
1)</tt> as its left-argument on the MouseMove event.</p><pre>      F1.onMouseMove ← 'FOO' ('THIS' 1)

</pre><h4>Specifying the Event property using <tt>⎕WC</tt> and <tt>⎕WS</tt></h4><h4>Examples using Event Names (<tt>⎕WS</tt>)</h4><p>Ignore MouseDown (1) event (APL will perform the default processing for you)</p><pre>      'F1' ⎕WS 'Event' 'MouseDown' 0</pre><p>Terminate <tt>⎕DQ</tt> on MouseDown</p><pre>      'F1' ⎕WS 'Event' 'MouseDown' 1</pre><p>Invoke callback function <tt>FOO</tt> on
MouseDown, the first element of the right argument to <tt>FOO</tt>will contain a <span class="Italic">namespace reference</span> to <tt>F1</tt>.</p><pre>      'F1' ⎕WS 'Event' 'onMouseDown' 'FOO'</pre><p>Invoke callback function <tt>FOO</tt> on
MouseDown, the first element of the right argument to <tt>FOO</tt>will contain the <span class="Italic">character vector</span><tt>'F1'</tt>.</p><pre>      'F1' ⎕WS 'Event' 'MouseDown' 'FOO'</pre><p>Invoke callback function <tt>FOO</tt> on
MouseDown and MouseUp</p><pre>      'F1' ⎕WS 'Event' ('onMouseDown' 'onMouseUp') 'FOO'</pre><p>Invoke callback function <tt>FOO</tt> with <tt>('THIS'
1)</tt> as its left-argument on MouseDown</p><pre>      'F1' ⎕WS 'Event' 'onMouseDown' 'FOO' ('THIS' 1)
</pre><p>Invoke callback function <tt>FOO</tt> with <tt>('THIS'
1)</tt> as its left-argument on MouseDown, MouseUp and MouseMove</p><pre>      EV ← 'onMouseDown' 'onMouseUp' 'onMouseMove'
      'F1' ⎕WS 'Event' EV 'FOO' ('THIS' 1)
</pre><p>Execute the expression <tt>COUNT +←1</tt> on
MouseDown</p><pre>      'F1' ⎕WS 'Event' 'MouseDown' '⍎COUNT+←1'
</pre><p>Execute the expression <tt>COUNT +←1</tt> on
MouseDown, MouseUp and MouseMove</p><pre>      EV ← 'MouseDown' 'MouseUp' 'MouseMove'
      'F1' ⎕WS 'Event' EV '⍎COUNT+←1'

</pre><h4>Examples using Event Numbers (<tt>⎕WS</tt>)</h4><p>Ignore MouseDown (1) event (APL will perform the default processing for you)</p><pre>      'F1' ⎕WS 'Event' (1 0)
      'F1' ⎕WS 'Event' 1 0     ⍝  Ditto</pre><p>Terminate <tt>⎕DQ</tt> on MouseDown</p><pre>      'F1' ⎕WS 'Event' (1 1)
      'F1' ⎕WS 'Event' 1 1     ⍝ Ditto</pre><p>Call function <tt>FOO</tt> on MouseDown</p><pre>      'F1' ⎕WS 'Event' (1 'FOO')
      'F1' ⎕WS 'Event' 1 'FOO'    ⍝ Ditto</pre><p>Call function <tt>FOO</tt> on MouseDown and
MouseUp</p><pre>      'F1' ⎕WS 'Event' ((1 2) 'FOO')
      'F1' ⎕WS 'Event' (1 2) 'FOO'              ⍝ Ditto
      'F1' ⎕WS 'Event' 1 2 'FOO'                ⍝ Ditto
      'F1' ⎕WS 'Event' (1 'FOO')(2 'FOO')       ⍝ Ditto</pre><p>Call function <tt>FOO</tt> with <tt>('THIS'
1)</tt> as its left-argument on MouseDown</p><pre>      'F1' ⎕WS 'Event' (1 'FOO' ('THIS' 1))
      'F1' ⎕WS 'Event' 1 'FOO' ('THIS' 1)       ⍝ Ditto</pre><p>Call function <tt>FOO</tt> with <tt>('THIS'
1)</tt> as its left-argument on MouseDown and MouseUp</p><pre>      'F1' ⎕WS 'Event' ((1 2) 'FOO' ('THIS' 1))
      'F1' ⎕WS 'Event' (1 2) 'FOO' ('THIS' 1)   ⍝ Ditto
      'F1' ⎕WS 'Event' 1 2 'FOO' ('THIS' 1)     ⍝ Ditto
      'F1' ⎕WS 'Event' 1 2 'FOO' ('THIS' 1)     ⍝ Ditto
</pre><p>Execute the expression <tt>COUNT +←1</tt> on
MouseDown</p><pre>      'F1' ⎕WS 'Event' 1 '⍎COUNT+←1'
</pre><p>Execute the expression <tt>COUNT +←1</tt> on
MouseDown, MouseUp and MouseMove</p><pre>      'F1' ⎕WS 'Event' (1 2 3) '⍎COUNT+←1'
      'F1' ⎕WS 'Event' 1 2 3 '⍎COUNT+←1'     ⍝ Ditto</pre><h4>User defined Events</h4><p>In addition to the standard events supported directly by Dyalog APL, you may
specify your own events. For these, you <b>must</b> use event numbers;
user-defined event names are not allowed.</p><p>You may use any numbers not already defined, but it is strongly recommended
that you choose numbers greater than 1000 to avoid potential conflict with a
future release of Dyalog APL.</p><p>You can only <b>generate</b> user-defined events under program control with <tt>⎕NQ</tt>.</p><pre> </pre></body>
</html>