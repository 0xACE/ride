<!doctype html>
<html>
<head><meta charset="utf-8"><title></title><link rel="stylesheet" href="../../../help.css"></head>
<body><h2><a name="Workspace_Management"></a>Workspace Management</h2><h4><a name="Workspace_Size_Compaction"></a>Workspace Size and Compaction</h4><p>The <span class="Italic">maximum</span> amount of memory allocated to a Dyalog APL workspace is defined by the <span class="Parameter">maxws</span> parameter.</p><p>Upon <tt>)LOAD</tt> and<tt> )CLEAR</tt>, APL allocates an amount of memory corresponding to the size of the workspace being loaded (which is zero for a clear ws) plus the <span class="Italic">workspace delta.</span></p><p>The workspace delta is 1/16<sup>th</sup> of maxws, except if there is less than 1/16<sup>th</sup> of <span class="Parameter">maxws</span> in use, delta is 1/64<sup>th</sup> of <span class="Parameter">maxws</span>. This may also be expressed as follows:</p><pre>      delta←maxws{⌈⍺÷⊃(⍵&gt;⍺÷16)⌽64 16}ws</pre><p>where <tt>maxws</tt> is the value of the <span class="Parameter">maxws</span> parameter and <tt>ws</tt> is the currently allocated amount of workspace. If <span class="Parameter">maxws</span> is 16384KB, the workspace delta is either 256KB or 1024 KB, and when you start with a <tt>clear ws</tt> the workspace occupies 256KB.</p><p>When you erase objects or release symbols, areas of memory become free. APL manages these free areas, and tries to reuse them for new objects. If an operation requires a contiguous amount of workspace larger than any of the available free areas, APL reorganises the workspace and amalgamates all the free areas into one contiguous block as follows:</p><ol><li value="1">Any un-referenced memory is discarded. This process, known as <span class="Italic">garbage collection</span>, is required because whole cycles of refs can become un-referenced.</li><li value="2">Numeric arrays are <span class="Italic">demoted</span> to their tightest form. For example, a simple numeric array that happens to contain only values 0 or 1, is demoted or <span class="Italic">squeezed</span> to have a <tt>⎕DR</tt> type of 11 (Boolean).</li><li value="3">All remaining used memory blocks are copied to the low-address end of the workspace, leaving a single free block at the high-address end. This process is known as <span class="Italic">compaction</span>.</li><li value="4">In addition to any extra memory required to satisfy the original request, an additional amount of memory, equal to the workspace delta, is allocated. This will always cause the process size to increase (up to the <span class="Parameter">maxws</span> limit) but means that an application will typically achieve its working process size with at most 4+15 memory reorganisations.</li><li value="5">However, if after compaction, the amount of used workspace is less than 1/16 of the Maximum workspace size (<span class="Parameter">maxws</span>), the amount reserved for working memory is reduced to 1/64th <span class="Parameter">maxws</span>. This means that workspaces that are operating within 1/16th of <span class="Parameter">maxws</span> will be more frugal with memory</li></ol><p>Note that if you try to create an object which is larger than free space, APL reports <tt>WS FULL</tt>.</p><p>The following system function and commands force a workspace reorganisation as described above:</p><pre>        ⎕WA, )RESET, )SAVE, )LOAD, )CLEAR</pre><p>However, in contrast to the above, <span class="Italic">any spare workspace above the workspace delta is returned to the Operating System</span>. On a Windows system, you can see the process size changing by using Task Manager.</p><p>The system function <tt>⎕WA</tt> may therefore be used judiciously (workspace reorganisation takes time) to reduce the process size after a particularly memory-hungry operation.</p><p>Note that in Dyalog APL, the SYMBOL TABLE is entirely dynamic and grows and shrinks in size automatically. There is no <tt>SYMBOL TABLE FULL</tt> condition.</p><p>Additional control of managing the memory used for the workspace can be found in  <a href="../../lang/primops/memory-manager-statistics.html#MemoryManagerStatistics" class="MCXref_0">Memory Manager Statistics</a> and
		                                                                                     <a href="../../lang/primops/specify-workspace-available.html#Specify_Workspace_Available" class="MCXref_0">Specify Workspace Available</a>.</p><script src="../../../help.js"></script></body>
</html>