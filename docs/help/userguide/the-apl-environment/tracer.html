<!doctype html>
<html>
<head><meta charset="utf-8"><title></title><link rel="stylesheet" href="../../../help.css"></head>
<body><h2><a name="Tracer"></a>The Tracer</h2><p>The Tracer is a visual debugging aid that allows you to step through an application line by line. During a Trace you can track the path taken through your code, display variables in edit windows and watch them change, skip forwards and backwards in a function. You can cutback the stack to a calling function and use the Session and Editor to experiment with and correct your code. The Tracer may be invoked in several ways as discussed below.</p><h4><a name="Tracing_Expression"></a>Tracing an expression</h4><p>Firstly, you may explicitly trace a function (strictly an expression) by typing an expression then pressing Ctrl+Enter (TC) or by selecting <span class="Name">Trace</span> from the <span class="Name">Action</span> menu. This lets you step through the execution of an expression from the beginning.</p><p>In the same way as when you execute a statement by pressing Enter, the expression is (if necessary) copied down to the input line and then executed. However, if the expression includes a reference to an unlocked defined function or operator, execution halts at its first line and a Trace window containing the suspended function or operator is displayed on the screen. The cursor is positioned to the left of the first line which is highlighted.</p><h4><a name="Naked_Trace"></a>Naked Trace</h4><p>The second way to invoke the Tracer is when you have a suspended function in the State Indicator and you press Ctrl+Enter (TC) on the empty input line. This is termed <span class="Italic">naked trace</span>. The same thing can be achieved by selecting <span class="Name">Trace</span> from the <span class="Name">Action</span> menu on the Session Window or by clicking the <span class="Name">Trace</span> button in the <span class="Name">Trace Tools.</span> However, in ALL cases it is essential that the input cursor is on the empty Input line in the Session.</p><p>The effect of naked trace is to open the Tracer and to position the cursor on the currently suspended line. It is exactly as if you had Traced to that point from the Input Line expression whose execution caused the suspension.</p><p> </p><h4>Automatic Trace</h4><p>The third way to invoke the Tracer is to have the system do it automatically for you whenever an error occurs. This is achieved by setting the Show trace stack on error option in the <span class="Name">Trace/Edit</span> tab of the <span class="Name">Configuration</span> dialog (<span class="Parameter">Trace_on_error</span> parameter). When an error occurs, the system will automatically deploy the Tracer. Note that this means that when an error occurs, the Trace window will then receive the input focus and not the Session window. </p><h4><a name="Tracer_Options"></a>Tracer Options</h4><p>From Version 10.1 onwards, the Tracer is designed to be docked in the Session window.</p><p>In previous versions of Dyalog APL, the Tracer was implemented as a stack of separate windows (one per function on the calling stack) or as a single, but still separate, window.</p><p>You can disable the standard behaviour by selecting <span class="Name">Classic Dyalog mode</span> from the <span class="Name">Trace/Edit</span> tab of the <span class="Name">Configuration</span> dialog box. </p><p>If you do so, you may then choose to have the Tracer operate in multiple windows or in a single window.</p><p>These alternatives are discussed later in this Chapter.</p><h4><a name="Trace_Window"></a>The Trace Window</h4><p>The Tracer is implemented as a single dockable window that displays the function that is currently being executed. There are two subsidiary information windows which are also fully dockable. The first of these (<span class="Name">SIStack</span>) displays the current function calling stack; the second (<span class="Name">Threads</span>) displays a list of running threads.</p><p>In the default Session files, the Tracer is docked along the bottom edge of the Session window. When you invoke the Tracer, it springs up as illustrated below. In this example, the function being traced is <tt>⎕SE.UCMD</tt>, which is invoked by typing a user-command, in this case <tt>]display</tt>.</p><p><img src="../images/tracer-1.png" /></p><p>In the default layout, the <span class="Name">SIstack</span> window is displayed alongside the main Tracer window, although this can be hidden or made to appear as a separate floating window, as required.</p><h4><a name="Trace_Tools"></a>Trace Tools</h4><p>The Tracer may be controlled from the keyboard, or by using the <span class="Name">Trace Tools </span>which are arranged along the title bar of the Debugger window. Note that the button names are solely for reference purposes in the description that follows.</p><table><tr><th>Button</th><th>Name</th><th>Key Code</th><th>Keystroke</th><th>Description</th></tr><tr><td class="IconTable"><img src="../images/trace-tools-exec-icon.png" /></td><td class="IconTable">Exec</td><td class="IconTable">ER</td><td class="IconTable">Enter</td><td class="IconTable">Executes the current line</td></tr><tr><td class="IconTable"><img src="../images/trace-tools-trace-icon.png" /></td><td class="IconTable">Trace</td><td class="IconTable">TC</td><td class="IconTable">Ctrl+Enter</td><td class="IconTable">Traces execution of the current line</td></tr><tr><td class="IconTable"><img src="../images/trace-tools-back-icon.png" /></td><td class="IconTable">Back</td><td class="IconTable">BK</td><td class="IconTable">Ctrl+Shift+Bksp</td><td class="IconTable">Skips back one line</td></tr><tr><td class="IconTable"><img src="../images/trace-tools-fwd-icon.png" /></td><td class="IconTable">Fwd</td><td class="IconTable">FD</td><td class="IconTable">Ctrl+Shift+Enter</td><td class="IconTable">Skips forward one line</td></tr><tr><td class="IconTable"><img src="../images/trace-tools-restart-icon.png" /></td><td class="IconTable">Restart</td><td class="IconTable">RM</td><td class="IconTable"><tt>→⎕LC</tt></td><td class="IconTable">Restarts execution of the current thread, closing all its trace windows</td></tr><tr><td class="IconTable"><img src="../images/trace-tools-resart-all-threads-icon.png" /></td><td class="IconTable">Restart all</td><td class="IconTable"> </td><td class="IconTable"> </td><td class="IconTable">Restarts execution for all threads, closing all trace windows</td></tr><tr><td class="IconTable"><img src="../images/trace-tools-continue-icon.png" /></td><td class="IconTable">Continue</td><td class="IconTable">BH</td><td class="IconTable"> </td><td class="IconTable">Continues execution of the current thread, leaving Trace windows displayed</td></tr><tr><td class="IconTable"><img src="../images/trace-tools-edit-icon.png" /></td><td class="IconTable">Edit</td><td class="IconTable">ED</td><td class="IconTable">Shift+Enter</td><td class="IconTable">Invokes the Editor</td></tr><tr><td class="IconTable"><img src="../images/trace-tools-exit-icon.png" /></td><td class="IconTable">Exit</td><td class="IconTable">EP</td><td class="IconTable">Esc</td><td class="IconTable">Closes the Trace window, exits the current function</td></tr><tr><td class="IconTable"><img src="../images/trace-tools-intr-icon.png" /></td><td class="IconTable">Intr</td><td class="IconTable"> </td><td class="IconTable">Ctrl+Pause</td><td class="IconTable">Interrupts execution</td></tr><tr><td class="IconTable"><img src="../images/trace-tools-reset-icon.png" /></td><td class="IconTable">Reset</td><td class="IconTable">CB</td><td class="IconTable"> </td><td class="IconTable">Clears all break-points (resets <tt>⎕STOP</tt> on every function)</td></tr></table><p>Using the Trace Tools, you can <b>single-step</b> through the function or operator by clicking the <span class="Name">Exec</span> and/or <span class="Name">Trace</span> buttons. If you click <span class="Name">Exec</span> the current line of the function or operator is executed and the system halts at the next line. If you click <span class="Name">Trace</span>, the current line is executed but any defined functions or operators referenced on that line are themselves traced. After execution of the line the system again halts at the next one. Using the keyboard, the same effect can be achieved by pressing Enter or Ctrl+Enter.</p><p>The illustration below shows the state of execution having clicked <span class="Name">Exec</span> 6 times to reach <tt>⎕SE.UCMD[7]</tt>.</p><p><img src="../images/tracer-2.png" /></p><p class="ImageCaption">Execution Reached <tt>⎕SE.UCMD[7]</tt></p><p>The next illustration shows the result of clicking <span class="Name">Trace</span> at this point. This caused the system to trace into <tt>⎕SE.SaltUtils.Spice</tt>, the function called from <tt>⎕SE.UCMD[7]</tt>.</p><p>Notice how each function call on the stack is represented by an item in the <span class="Name">SIstack</span> window.</p><p><img src="../images/tracer-3.png" /></p><p class="ImageCaption">Execution Reached <tt>⎕SE.SALTUtils.Spice [1]</tt></p><p>The illustration below shows the state of execution having traced deeper into the system.</p><p><img src="../images/tracer-4.png" /></p><p class="ImageCaption">Execution reached four levels deep</p><p>At this stage, the State Indicator is as follows:</p><pre>      )SI
⎕SE.SALT.Load[1]*
⎕SE.SALTUtils.BootSpice[17]
⎕SE.SALTUtils.Spice[18]
⎕SE.UCMD[7]</pre><h4><a name="Controlling_Execution"></a>Controlling Execution</h4><p>The point of execution may be moved by clicking the <span class="Name">Back</span> and <span class="Name">Fwd</span> buttons in the <span class="Name">Trace Tools</span> window or, using the keyboard, by pressing Ctrl+Shift+Bksp and Ctrl+Shift+Enter.  Notice however that these buttons do not themselves change the State Indicator or the display in the <span class="Name">SIStack</span> window. This happens only when you restart execution from the new point.</p><p>You can cut back the stack by clicking the &lt;EP&gt; button in the <span class="Name">Trace Tools</span> window. This causes execution to be suspended at the start of the line which was previously traced. The same effect can be achieved using the keyboard by pressing Esc. It can also be done by selecting <span class="Name">Exit</span> from the <span class="Name">File</span> menu on the Trace Window or by selecting <span class="Name">Close</span> from its system menu.</p><p>The &lt;RM&gt; button removes the Trace window and resumes execution. The same is achieved by the expression <tt>→⎕LC</tt>. The &lt;BH&gt; button also continues execution, but leaves the Trace window displayed and allows you to watch its progress.</p><h4><a name="Using_Session_Editor"></a>Using the Session and the Editor</h4><p>Whilst using the Tracer you can skip to the Session or to any Edit window and back again. While it is docked, you may resize the Tracer pane by dragging its title bar, and you may use the buttons provided to maximise, minimise and restore the Tracer pane within the Session window.</p><p>Unless you move it, the cursor is positioned to the left of the suspended line in the top Trace window.</p><p>Depending where the cursor is in the tracer window, pressing Shift+Enter (ED) or selecting <span class="Name">Edit</span> from the <span class="Name">File</span> menu may cause an edit window to open.  If the cursor is in the first column of the Trace window, or on whitespace, the Editor is opened on function or operator on top of the stack.  If the cursor in on a name, the Editor is opened on the name under the cursor (point-and-edit).  With the cursor in any other location, no action is undertaken.</p><p>When you finish editing, the window reverts to a trace window with the new definition of the function or operator displayed.</p><p>You may also open a new edit window from within the Tracer using point-and-edit. </p><p>You can copy text from a trace window to the session for editing and execution or for experimentation.</p><p>It is possible to skip from the Tracer to the Session and then re-invoke the Tracer on a different expression.</p><h4><a name="Breakpoints"></a>Setting Break-Points</h4><p>Break-points are defined by <tt>⎕STOP</tt> and may be toggled on and off in an Edit or Trace window by clicking in the appropriate column. The example below illustrates a function with a <tt>⎕STOP</tt> break-point set on line <tt>[5]</tt>.</p><p><img src="../images/tracer-5.png" /></p><p><tt>⎕STOP</tt> break-points set or cleared in an Edit window are not established until the function is fixed. <tt>⎕STOP</tt> break-points set or cleared in a Trace window are established immediately.</p><h4>Clearing All Break-Points</h4><p><img src="../images/trace-tools-reset-icon.png" /></p><p>You can clear all break-points by pressing the above button in the Trace Tools window. This in fact resets <tt>⎕STOP</tt> for all functions in the workspace.</p><h4><a name="Classic_Tracer"></a>The Classic mode Tracer</h4><p>If you select <span class="Name">Classic Dyalog mode</span> from the <span class="Name">Trace/Edit</span> tab in the <span class="Name">Configuration</span> dialog box, the Tracer behaves in the same way as in Dyalog APL Version 8.2. However, the Tracer is not dockable in the Session.</p><p>If you select the Classic mode Tracer, you may choose between multiple trace windows or a single trace window using the <span class="Name">Single Trace Window</span> option.</p><h4>Multiple Trace Windows</h4><p>The following behaviour is obtained by <b>deselecting</b> the <span class="Name">Single Trace Window</span> option.</p><ul><li value="1">Each function on the SI stack is represented by a separate trace window. The top window contains the function that is currently executing, other windows display functions further up the stack, in the order in which they were called.</li><li value="2">When you press Ctrl+Enter or click the <span class="Name">Trace</span> button on a line that calls another function, a new trace window appears on top of the stack and displays the newly called function.</li><li value="3">When a function exits, its trace window disappears and the focus moves to the previous trace window. When the last function in a traced suspension exits, the last trace window disappears.</li><li value="4">If you click the <span class="Name">Quit this function</span> button in the <span class="Name">Trace Tools</span> window, or press Escape, or close the trace window by clicking on its [X] button or typing Alt-F4, the top trace window disappears and the focus moves to the previous trace window</li><li value="5">If you close any of the trace windows further down the stack, the stack will be cut back to the corresponding point, i.e. to the line of code that called the function whose trace window you closed.</li><li value="6">The &lt;RM&gt; button removes all the trace windows and resumes execution. The same is achieved by the expression <tt>→⎕LC</tt>. The &lt;CS&gt; button also continues execution, but leaves the trace windows displayed and allows you to watch their progress.</li><li value="7">If you minimise any of the trace windows, the entire stack is minimised to a single icon, from which it may be restored.</li></ul><h4>Single Trace Window</h4><p>The following behaviour is obtained by <b>selecting</b> the Single Trace Window option.</p><ul><li value="1">The trace window contains a combo box whose drop-down displays the contents of the SI stack. This box is not provided if there are multiple trace windows.</li><li value="2">The trace window is re-used when tracing into, or returning from, a called function. This means that there is never more than one trace window present.</li><li value="3">When the last function in a traced suspension exits, the trace window disappears.</li><li value="4">If you click the <span class="Name">Quit this function</span> button in the <span class="Name">Trace Tools </span>window, or press Escape, the current function is removed from the stack and the trace window reused to display the calling function if there is one.</li><li value="5">Closing the trace window by clicking on its [X] button or typing Alt-F4 removes the window and <span class="Italic">clears the current suspension</span>. It is equivalent to typing naked branch (<tt>→</tt>) in the session window.</li><li value="6">If you move or resize the trace window, APL remembers its position, so that it reappears in the same position when next used.</li></ul><script src="../../../help.js"></script></body>
</html>