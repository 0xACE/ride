<!doctype html>
<html>
<head><meta charset="utf-8"><title></title><link rel="stylesheet" href="../../../help.css"></head>
<body><h2><a name="Function_Trains"></a>Function Trains</h2><h4>Introduction</h4><p>A <span class="Name">Train</span> is a sequence of 2 or 3 items in an expression which bind together to form a function. Each item in a train may be an array or a function but the right-most item must be a function.</p><h4>Forks and Atops</h4><p>The following trains are supported where <tt>f</tt>, <tt>g</tt> and <tt>h</tt> are functions and <tt>A</tt> is an array:</p><pre>      f g h<br />      A g h<br />        g h</pre><p>The 3-item trains <tt>(f g h)</tt> and <tt>(A g h)</tt> are termed <span class="Name">forks</span> while the 2-item train <tt>(g h)</tt> is termed an <span class="Name">atop</span>. To distinguish the two styles of <span class="Name">fork</span>, we can use the terms <span class="Name">fgh-fork</span> or <span class="Name">Agh-fork</span>.</p><h4>Trains as Functions</h4><p>A train is syntactically equivalent to a function and so, in common with any other function, may be:</p><ul><li value="1">named using assignment</li><li value="2">applied to or between arguments</li><li value="3">consumed by operators as operands</li><li value="4">and so forth.</li></ul><p>In particular, trains may be applied to a single array (monadic use) or between 2 arrays (dyadic use), providing  six new constructs.</p><pre>    ⍺(f g h)⍵ ←→ (⍺ f ⍵) g (⍺ h ⍵)   ⍝ dyadic (fgh) fork
    ⍺(A g h)⍵ ←→    A    g (⍺ h ⍵)   ⍝ dyadic (Agh) fork
    ⍺(  g h)⍵ ←→         g (⍺ h ⍵)   ⍝ dyadic       atop

     (f g h)⍵ ←→ (  f ⍵) g (  h ⍵)   ⍝ monadic (fgh) fork
     (A g h)⍵ ←→    A    g (  h ⍵)   ⍝ monadic (Agh) fork
     (  g h)⍵ ←→         g (  h ⍵)   ⍝ monadic       atop</pre><h4>Identifying a Train</h4><p>For a sequence to be interpreted as a train it must be separated from the argument to which it is applied. This can be done using parentheses or by naming the derived function.</p><h4>Example - fork: negation of catenated with reciprocal of</h4><pre>      (-,÷)5         
¯5 0.2</pre><h4>Example - named fork</h4><pre>      negrec←-,÷ 
      negrec 5
 ¯5 0.2</pre><p>Whereas, without these means to identify the sequence as a train, the expression:</p><pre>      -,÷ 5         
¯0.2</pre><p>means the negation of the ravel of the reciprocal of 5.</p><h4>Idiom Recognition</h4><p>Function trains lend themselves to idiom recognition, a technique used to optimise the performance of certain expressions.</p><h4>Example</h4><p>An expression to find the first position in a random integer vector <tt>X</tt> of a number greater than 999000 is:</p><pre>      X←?1e6⍴1e6
      (X≥999000)⍳1
1704</pre><p>A function train is not only more concise, it is faster too.</p><pre>
      X (⍳∘1 ≥) 999000
1704</pre><h4>Trains of Trains</h4><p>As a train resolves to a function, a sequences of more than 3 functions represents a train of trains. Function sequences longer than 3 are bound in threes, starting from the right:</p><pre>... fu fv fw fx fy fz → ... fu (fv fw (fx fy fz))</pre><p>This means that, in the absence of parentheses, a sequence of an odd number of functions resolves to a 3-train (fork) and an even-numbered sequence resolves to a 2-train (atop):</p><pre>e f g h i j k → e f(g h(i j k))     ⍝ fork(fork(fork))<br />f g h i j k →   f(g h(i j k))       ⍝ atop(fork(fork))</pre><h4>Examples</h4><pre>      6( +,-,×,÷)2     ⍝ fork:(6+2),((6-2),((6×2),(6÷2)))
8 4 12 3

      6(⌽+,-,×,÷)2     ⍝ atop: ⌽ (6+2), ...
3 12 4 8

      ]boxing on
Was OFF</pre><pre>
      +,-,×,÷          ⍝ boxed display of fork
┌─┬─┬─────────────┐
│+│,│┌─┬─┬───────┐│
│ │ ││-│,│┌─┬─┬─┐││
│ │ ││ │ ││×│,│÷│││
│ │ ││ │ │└─┴─┴─┘││
│ │ │└─┴─┴───────┘│
└─┴─┴─────────────┘
      ⌽+,-,×,÷         ⍝ boxed display of atop
┌─┬───────────────────┐
│⌽│┌─┬─┬─────────────┐│
│ ││+│,│┌─┬─┬───────┐││
│ ││ │ ││-│,│┌─┬─┬─┐│││
│ ││ │ ││ │ ││×│,│÷││││
│ ││ │ ││ │ │└─┴─┴─┘│││
│ ││ │ │└─┴─┴───────┘││
│ │└─┴─┴─────────────┘│
└─┴───────────────────┘</pre><pre>      ]boxing -trains=tree
Was -trains=box
      +,-,×,÷          ⍝ boxed (tree) display of fork
┌─┼───┐      
+ , ┌─┼───┐  
    - , ┌─┼─┐
        × , ÷
</pre><h4>Binding Strengths</h4><p>The binding strength between the items of a train is less than that of operand-operator binding. In other words, operators bind first with their function (or array) operands to form derived functions, which may then participate as items in a train.</p><h4> Example:</h4><pre>      +⌿ ÷ ≢            ⍝ fork for mean value
┌─────┬─┬─┐
│┌─┬─┐│÷│≢│
││+│⌿││ │ │
│└─┴─┘│ │ │
└─────┴─┴─┘

      ⌊/,⌈/             ⍝ fork for min_max
┌─────┬─┬─────┐
│┌─┬─┐│,│┌─┬─┐│
││⌊│/││ ││⌈│/││
│└─┴─┘│ │└─┴─┘│
└─────┴─┴─────┘</pre><p>This means that any of the four hybrid tokens <tt>/ ⌿ \ ⍀</tt> will not be interpreted as a function if there's a function to its left in the train. In order to fix one of these tokens as a replicate or expand function, it must be isolated from the function to its left:</p><pre>      (⍳/⍳)3        ⍝ → ⍳/ atop ⍳3 → RANK ERROR
RANK ERROR

      (⍳{⍺/⍵}⍳)3    ⍝ → (⍳3){⍺/⍵}(⍳3) → (⍳3)/(⍳3)
1 2 2 3 3 3

      (⍳(/∘⊢)⍳)3    ⍝ → (⍳3)/⊢(⍳3)
1 2 2 3 3 3

      (2/⍳)3        ⍝ Agh-fork is OK
1 1 2 2 3 3</pre><script src="../../../help.js"></script></body>
</html>