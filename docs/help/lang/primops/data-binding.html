<!doctype html>
<html>
<head><meta charset="utf-8"><title></title><link rel="stylesheet" href="../../../help.css"></head>
<body><h2><tt>R←{X}2015⌶Y</tt>Data Binding</h2><p>Creates an object that may be used as a data source for WPF data binding.<span class="MCTextPopup"><span class="MCTextPopupBody_0" style="display: none; ">It is beyond the scope of this document to fully explain the concepts of WPF data binding. See Microsoft Developer Network, Data Binding Overview. </span><a href="javascript:void(0);" class="MCTextPopupSpot_0" onclick="FMCTextPopup( event, this ); return false;" style="font-size: 0.9em; vertical-align: super">1</a></span></p><p>Data binding connects a <span class="Name">Binding Target</span> to a <span class="Name">Binding Source</span>. In WPF a Binding Target is a particular property of a user interface object; for example, the <span class="Member">Text</span> property of a <span class="NetType">TextBox</span> object. A Binding Source is  a <span class="Name">Path</span> to a value in a data object (which may contain other values). The value of the Binding Source determines the value of the Binding Target. If two-way binding is in place, a change in a user-interface component causes the bound data value to change accordingly. In the example of the <span class="NetType">TextBox</span>, the value in the Binding Source changes as the user types into the <span class="NetType">TextBox</span>.</p><p><tt>Y</tt> is a character vector containing one of the following:</p><ul><li value="1">the name of a variable</li><li value="2"> the name of a  namespace containing one or more variables</li><li value="3"> the name of a variable containing a vector of refs to namespaces, each of which contains one or more variables.</li></ul><p>If the name specified by <tt>Y</tt> doesn't exist or represents neither a variable nor a namespace,  the function reports <tt>DOMAIN ERROR</tt>. Currently, no further validation of the structure and contents of <tt>Y</tt> is performed, but nothing other than the examples described herein is supported.</p><p>If the optional left argument <tt>X</tt> is given and <tt>Y</tt> is an variable other than a ref, <tt>X</tt> specifies the binding type for that variable. If <tt>Y</tt> specifies one or more namespaces, <tt>X</tt> specifies the names and binding types of each of the variables which are to be bound, contained in the namespaces specified by  <tt>Y</tt>.</p><p>The structure of <tt>X</tt> depends upon the structure of <tt>Y</tt> and is discussed later in this topic.</p><p> If <tt>X</tt> is omitted, all of the variables specified by <tt>Y</tt> are bound with default binding types.</p><p>Here the term <span class="Name">bind variable</span> refers to any variable specified by <tt>X</tt> and <tt>Y</tt> to be bound, and the term <span class="Name">binding type</span> means the .Net data type to which the value of the bind variable is converted before it is passed to the .Net interface. </p><p><tt>2015⌶</tt> creates a Binding Source object <tt>R</tt>. This is a .Net object which contains <span class="Name">Path</span>(s) to one or more bind variables. This object may then be assigned to a property of a WPF object or passed a s as a parameter to a WPF method that requires a Binding Source.</p><h4>Bind Variables and Bind Types</h4><p>A bind variable should be of rank 2 or less. Higher rank arrays are not supported.</p><p>If not specified by <tt>X</tt>, the  binding type of a bind variable is derived from its content  at the time <tt>2015⌶</tt> is executed. The binding type is then stored with the variable in the workspace. There is no mechanism to change a variable's binding type without erasing the variable and re-executing <tt>2015⌶</tt>. If you change the type or rank of a bind  variable while it is bound (for example from a variable to a namespace), the behaviour of the system is unpredictable.</p><p>The default binding type is derived as follow:</p><p>If the bind variable is a simple scalar number the default binding type is <span class="NetType">System.Object</span>. At the point when the value of the variable is passed to the .Net interface this will be cast to a numeric type such as  <span class="NetType">System.Int16</span>, <span class="NetType">System.Int32</span>, <span class="NetType">System.Int64</span>, or <span class="NetType">System.Double</span>, depending upon the internal representation of the data. The .Net property to which it is bound will typically only accept a single Type (for example <span class="NetType">System.Int32</span>), so to avoid unpredictable behaviour,  it is recommended that the left argument <tt>X</tt> be used to specify the binding type for numeric data.</p><p> If the bind variable is a character scalar or vector, the default binding type is also <span class="NetType">System.Object</span>, but at the point  when the value of the variable is passed to the .Net interface it will always be passed as <span class="NetType">System.String</span>,which is suitable for binding to any property that accepts a <span class="NetType">System.String</span>, such as the <span class="Member">Text</span> property of a <span class="NetType">TextBox</span>. </p><p>If the bind variable is a vector other than a simple character vector, such as a vector of character vectors,  a simple numeric vector, or a vector of .Net objects, the bind type will be a collection. This is suitable for binding to any property that  represents a collection (list) of items, for example the <span class="Member">ItemsSource</span> property of a <span class="NetType">ListBox</span>.</p><p>If the bind variable is a matrix, the default binding type is <span class="NetType">System.Object</span>. It is likely that in a future release a rank-2 array will be bound as a <span class="NetType">DataTable</span>.</p><p>All the examples that follow assume <tt>⎕USING←'System'</tt>.</p><h4>Binding Single Variables</h4><p>In this case, <tt>Y</tt> specifies the name of a variable which is one of the following:</p><ul><li value="1"> character vector (or scalar)</li><li value="2">numeric scalar</li><li value="3">scalar .Net object (not currently supported)</li><li value="4"> vector of character vectors</li><li value="5">numeric vector</li><li value="6">vector of .Net objects</li><li value="7">matrix (not currently supported)</li></ul><p><tt>X</tt> (if specified) defines the binding type for the bind variable named by <tt>Y</tt> and is a single .Net Type.</p><p>Note that in the following examples, the reason for expunging the name first is discussed in the section headed <span class="XRef">Rebinding a Variable</span>.</p><h4>Binding a Character Vector</h4><p>This example illustrates how to bind a variable which contains a character vector. </p><pre>      ⎕EX'txtSource'
      txtSource←HELLO WORLD'
      bindsource←2015⌶'txtSource'</pre><p>In this example, the binding type of the variable <tt>txtSource</tt> will be <span class="NetType">System.String</span>, suitable for binding to any property that accepts a String, such as the <span class="Member">Text</span> property of a <span class="NetType">TextBox</span>.</p><h4>Binding a Numeric Scalar</h4><p>This example illustrates how to bind a variable which contains a numeric scalar value.</p><pre>      ⎕EX'sizeSource'
      sizeSource←36
      bindSource←Int32(2015⌶)'sizeSource'</pre><p>In this example, the left argument <tt>Int32</tt> specifies that the binding type for the variable sizeSource is to be <span class="NetType">System.Int32</span>. This means that whenever APL passes the value of <tt>sizeSource</tt> to the control, it will first be cast to an <span class="NetType">Int32</span>. This makes it suitable, for example, for binding to the <span class="Member">FontSize</span> property of a <span class="NetType">TextBox</span>.</p><p>A number of controls have a <span class="Member">Value</span> property which must be expressed as a <span class="NetType">System.Double</span>. The next example shows how to create a Binding Source for such a variable.</p><pre>      ⎕EX'valSource'
      valSource←42
      bindSource←Double(2015⌶)'valSource'</pre><h4>Binding a  Scalar .Net Object</h4><p>This is not supported in the first release of Version 14.0. It is intended that it will be added in due course.</p><h4>Binding a Vector of Character Vectors</h4><p>WPF data binding provides the means to bind controls that display lists of items, such as the <span class="NetType">ListBox</span>, <span class="NetType">ListView</span>, and <span class="NetType">TreeView</span> controls, to collections of data. These controls are all based upon the <span class="NetType">ItemsControl</span> class. To bind an <span class="NetType">ItemsControl</span> to a collection object, you use its <span class="Member">ItemsSource</span> property.  </p><p>This example illustrates how to bind a variable which contains a vector of character vectors. </p><pre>      ⎕EX'itemsSource'
      itemsSource←'beer' 'wine' 'water'
      bindsource←2015⌶'itemsSource'</pre><p>In this example, the binding type of the variable <tt>itemsSource</tt> will be <span class="NetType">System.Collection</span>, suitable for binding to the <span class="Member">ItemSource</span> property of an <span class="NetType">ItemsControl</span>.</p><h4>Binding a Numeric Vector</h4><p>By default, a numeric vector is bound in the same way as a vector of character vectors, i.e. as a <span class="NetType">System.Collection</span>, suitable for binding to the <span class="Member">ItemSource</span> property of an <span class="NetType">ItemsControl</span>.</p><pre style="font-style: normal;">      ⎕EX'yearsSource'
      yearsSource←2000+⍳20
      bindSource←2015⌶'yearsSource'</pre><p>In principle, a numeric vector may alternatively be bound to a WPF property that requires a 1-dimensional numeric array, by specifying the appropriate data type (e.g. <span class="NetType">Int32</span>, <span class="NetType">Double</span>) for the array as the left argument. For example:</p><pre style="font-style: normal;">      ⎕EX'arraySource'
      arraySource←42 24
      bindSource←Int32 (2015⌶)'arraySource'</pre><h4 class="ExampleNewPage">Binding a Vector of .Net Objects</h4><p>A vector of .Net objects is bound in the same way as a vector of character vectors, i.e. as a <span class="NetType">System.Collection</span>, suitable for binding to the <span class="Member">ItemSource</span> property of an <span class="NetType">ItemsControl</span>.</p><pre>      ↑Easter
2015 4 12
2016 5  1
2017 4 16
2018 4  8
2019 4 28
2020 4 19
2021 5  2
2022 4 24
2023 4 16
2024 5  5
      dt←{⎕NEW DateTime ⍵}¨Easter
      bindSource←2015⌶'dt'
</pre><h4>Binding a Matrix</h4><p>Currently, the system allows a bind variable to contain a matrix (simple or nested) but the default binding type is <span class="NetType">System.Object</span>. This is unlikely to be of any use. It is intended that in a future release of Dyalog APL a matrix will be bound as a <span class="NetType">DataTable</span> or similar.</p><h4>Rebinding a Variable</h4><p>As mentioned earlier, when a variable is bound its binding type is stored with it in the workspace. If you subsequently attempt to rebind the variable there is no mechanism in place to alter the binding type. If the current binding type (whether specified by the left argument <tt>X</tt>, or by being the default) differs from the saved one, the function will generate a <tt>DOMAIN ERROR</tt>.</p><pre>      num←42
      bs←2015⌶'num'

      bs←'Int32'(2015⌶)'num'
DOMAIN ERROR: You cannot redefine the binding types
      bs←'Int32'(2015⌶)'num'
     ∧
</pre><p>In this example, perhaps the programmer realised after binding <tt>num</tt> (with a default binding type of <span class="NetType">System.Object</span>) that the binding type should really be <span class="NetType">System.Int32</span>, and simply was trying to correct the error. To avoid this problem, it is recommended that you expunge the name before using it.</p><p class="pagebreakafter"> </p><pre>      ⎕EX 'num'
      num←42
      bs←2015⌶'num'⍝ (default) binding type System.Object
      
      ⎕EX 'num'
      num←42
      bs←Int32(2015⌶)'num'</pre><h4>Binding A Namespace</h4><p>In this case, <tt>Y</tt> specifies the name of a namespace that contains one or more variables. By default, each variable is bound using its default binding type as described above. Objects other than variables are ignored.</p><p>If it is required to specify the binding type of any of the variables, or if certain variables are to be excluded, the left argument is a 2-column matrix. The first column contains the names of the variables to be bound, and the second column their binding types.</p><h4>Example</h4><p>The following code snippet binds a namespace containing two variables named <tt>txtSource</tt> and <tt>sizeSource</tt>. In this case, the name of each variable may be specified as the Path for a WPF property that requires a <span class="NetType">String</span> or an <span class="NetType">Int32</span>. For example, if <span class="NetType">bindSource</span> were assigned to the <span class="Member">DataContext</span> property of a <span class="NetType">TextBox</span>, its <span class="Member">Text</span> property could be bound to <tt>txtSource</tt> and its <span class="Member">FontSize</span> property to <tt>sizeSource</tt>.</p><pre>      src←⎕NS''
      src.txtSource←'Hello World'
      src.sizeSource←36
      options←2 2⍴'txtSource'String'sizeSource'Int32
      bindSource←options(2015⌶)'src'</pre><h4>Binding a Vector of Namespaces</h4><p>In this case, <tt>Y</tt> specifies the name of a variable that contains a vector of refs to namespaces. In this case, the result <tt>R</tt> is of type <span class="NetType">Dyalog.Data.DataBoundCollectionHandler</span> which is suitable for binding to a WPF property that requires  an <span class="NetType">IEnumerable</span> implementation, such as the  <span class="Member">ItemsSource</span> property of the <span class="NetType">DataGrid</span>.</p><p>Each namespace in <tt>Y</tt> represents one of a collection of  instances of an object, which exports a particular set of properties for binding purposes. For example, <tt>Y</tt> could specify a wine database where each namespace represents a different wine, and each namespace contains the same set of variables that contain the name, price (and so forth) of each wine.</p><h4 class="ExampleNewPage">Example</h4><pre> winelist←⎕NS¨(⍴Wines)⍴⊂''
 winelist.Name←Wines
 winelist.Price←0.01×10000+?(⍴Wines)⍴10000
 
 bindSource←2015⌶'winelist'</pre><script src="../../../help.js"></script></body>
</html>