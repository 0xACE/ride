<!doctype html>
<html>
<head><meta charset="utf-8"><title></title><link rel="stylesheet" href="../../../help.css"></head>
<body><h2><tt>R←⎕DMX</tt>Extended Diagnostic Message </h2><p><tt>⎕DMX</tt> is a system object that provides information about the last reported APL error. <tt>⎕DMX</tt> has <span class="Italic">thread scope</span>, i.e. its value differs according to the thread from which it is referenced. In a multi-threaded application therefore, each thread has its own value of <tt>⎕DMX</tt>.</p><p><tt>⎕DMX</tt> contains the following Properties (name class 2.6). Note that this list is likely to change. Your code should not assume that this list will remain unchanged. You should also not assume that the display form of <tt>⎕DMX</tt> will remain unchanged.</p><table><tr><td><tt>Category</tt></td><td>character vector</td><td>The category of the error </td></tr><tr><td><tt>DM</tt></td><td>nested vector</td><td>Diagnostic message. This is the same as  <tt>⎕DM</tt>, but <i>thread safe</i></td></tr><tr><td><tt>EM</tt></td><td>character vector</td><td>Event message; this is the same as <tt>⎕EM ⎕EN</tt></td></tr><tr><td><tt>EN</tt></td><td>integer</td><td>Error number. This is the same as <tt>⎕EN</tt>, but <i>thread safe</i></td></tr><tr><td><tt>ENX</tt></td><td>integer</td><td>Sub-error number</td></tr><tr><td><tt>HelpURL</tt></td><td>character vector</td><td>URL of a web page that will provide help for this error. APL identifies and has a handler for URLs starting with <span class="Name">http:</span>, <span class="Name">https:</span>, <span class="Name">mailto:</span> and <span class="Name">www.</span> This list may be extended in future</td></tr><tr><td><tt>InternalLocation</tt></td><td>nested vector</td><td>Identifies the line of interpreter source code (file name and line number) which raised the error. This information may be useful to Dyalog support when investigating an issue</td></tr><tr><td><tt>Message</tt></td><td>character vector</td><td>Further information about the error</td></tr><tr><td><tt>OSError</tt></td><td>see below</td><td>If applicable, identifies the error generated by the Operating System              </td></tr><tr><td><tt>Vendor</tt></td><td>character vector</td><td>For system generated errors, <tt>Vendor</tt> will always contain the character vector <tt>'Dyalog'</tt>. This value can be set using <tt>⎕SIGNAL</tt></td></tr></table><p>OSError is a 3-element vector whose items are as follows:</p><table><tr><td><tt>1</tt></td><td>integer</td><td>This indicates how the operating system error was retrieved.<br />0 = by the C-library <span class="Code">errno()</span> function<br />1 = by the Windows <span class="Code">GetLastError()</span> function</td></tr><tr><td><tt>2</tt></td><td>integer</td><td>Error code. The error number returned by the operating system using <span class="Code">errno()</span> or <span class="Code">GetLastError()</span> as above</td></tr><tr><td><tt>3</tt></td><td>character vector</td><td>The description of the error returned by the operating system</td></tr></table><h4>Example</h4><pre>      1÷0
DOMAIN ERROR
      1÷0
     ∧
      ⎕DMX
 EM       DOMAIN ERROR                              
 Message  Divide by zero                            
 HelpURL  http://help.dyalog.com/dmx/13.1/General/1 

      ⎕DMX.InternalLocation
 arith_su.c  554
</pre><h4>Isolation of Handled Errors</h4><p><tt>⎕DMX</tt> cannot be explicitly localised in the header of a function. However, for all trapped errors, the interpreter creates an environment which effectively makes the current instance of <tt>⎕DMX</tt> local to, and available only for the duration of, the trap-handling code.</p><p>With the exception of <tt>⎕TRAP</tt> with Cutback,  <tt>⎕DMX</tt> is implicitly localised within:</p><ul><li value="1">Any function which explicitly localises <tt>⎕TRAP</tt></li><li value="2">The <tt>:Case[List]</tt> or <tt>:Else</tt> clause of a <tt>:Trap</tt> control structure.</li><li value="3">The right hand side of a D-function Error-Guard.</li></ul><p> and is implicitly un-localised when:</p><ul><li value="1">A function which has explicitly localised <tt>⎕TRAP</tt> terminates (even if the trap definition has been inherited from a function further up the stack).</li><li value="2">The <tt>:EndTrap</tt> of the current <tt>:Trap</tt> control structure is reached.</li><li value="3">A D-function Error-Guard exists.</li></ul><p>During this time, if an error occurs then the localised <tt>⎕DMX</tt> is updated to reflect the values generated by the error.</p><p>The same is true for <tt>⎕TRAP</tt> with Cutback, with the exception that  if the cutback trap event is triggered, the updated values for <tt>⎕DMX</tt> are preserved until the function that set the cutback trap terminates.</p><p>The benefit of the localisation strategy is that code which uses error trapping as a standard operating procedure (such as a file utility which traps <tt>FILE NAME ERROR</tt> and creates missing files when required) will not pollute the environment with irrelevant error information.</p><h4>Example</h4><pre>     ∇ tie←NewFile name
[1]    :Trap 22
[2]        tie←name ⎕FCREATE 0
[3]    :Else
[4]        ⎕DMX
[5]        tie←name ⎕FTIE 0
[6]        name ⎕FERASE tie
[7]        tie←name ⎕FCREATE 0
[8]    :EndTrap
[9]    ⎕FUNTIE tie
     ∇
</pre><p><tt>⎕DMX</tt> is cleared by  <tt>)RESET</tt>, .</p><pre>
      )reset
      ⍴⎕FMT ⎕DMX
0 0
</pre><p>The first time we run <tt>NewFile 'pete'</tt>, the file doesn't exist and  the <tt>⎕FCREATE</tt> in <tt>NewFile[2] </tt>succeeds.</p><pre class="APLCodeSmall">
      NewFile 'pete'
1</pre><p>If we run the function again, the <tt>⎕FCREATE</tt> in <tt>NewFile[2]</tt>generates an error which triggers the <tt>:Else</tt> clause of the :<tt>Trap</tt>.  On entry to the <tt>:Else</tt> clause, the values in <tt>⎕DMX</tt> reflect the error generated by <tt>⎕FCREATE</tt>. The file is then tied, erased and  recreated.</p><pre class="APLCodeSmall"> EM       FILE NAME ERROR                                       
 Message  File exists                                           
 HelpURL  http://help.dyalog.com/dmx/13.1/Componentfilesystem/9 
1</pre><p>After exiting the <tt>:Trap</tt> control structure, the shadowed value of <tt>⎕DMX</tt> is discarded, revealing the orignal value that it shadowed.</p><pre class="APLCodeSmall">
      ⍴⎕FMT ⎕DMX
0 0</pre><h4>Example</h4><p>The <tt>EraseFile</tt> function also uses a <tt>:Trap</tt> in order to ignore the situation when the file doesn't exist.</p><pre class="APLCodeSmall">     ∇ EraseFile name;tie
[1]    :Trap 22
[2]        tie←name ⎕FTIE 0
[3]        name ⎕FERASE tie
[4]    :Else
[5]        ⎕DMX
[6]    :EndTrap
     ∇</pre><p>The first time we run the function, it succeeds in tieing and then erasing the file.</p><pre class="APLCodeSmall">
      EraseFile 'pete'</pre><p>The second time, the <tt>⎕FTIE</tt> fails. On entry to the <tt>:Else</tt> clause, the values in <tt>⎕DMX</tt> reflect this error.</p><pre class="APLCodeSmall">
      EraseFile 'pete'
 EM       FILE NAME ERROR                                        
 Message  Unable to open file                                    
 OSError  1 2  The system cannot find the file specified.        
 HelpURL  http://help.dyalog.com/dmx/13.1/Componentfilesystem/11</pre><p>Once again, the local value of <tt>⎕DMX</tt> is discarded on exit from the <tt>:Trap</tt>, revealing the shadowed value as before.</p><pre class="APLCodeSmall">
      ⍴⎕FMT ⎕DMX
0 0</pre><h4>Example</h4><p>In this example only the error number (<tt>EN</tt>) propery of <tt>⎕DMX</tt> is displayed in order to simplify the output:</p><pre>
     ∇ foo n;⎕TRAP
[1]    'Start foo'⎕DMX.EN
[2]    ⎕TRAP←(2 'E' '→err')(11 'C' '→err')
[3]    goo n
[4]   err:'End foo:'⎕DMX.EN
     ∇

     ∇ goo n;⎕TRAP
[1]    ⎕TRAP←5 'E' '→err'
[2]    ⍎n⊃'÷0' '1 2+1 2 3' '∘'
[3]   err:'goo:'⎕DMX.EN
     ∇
</pre><p>In the first case a <tt>DOMAIN ERROR</tt> (11) is generated on <tt>goo[2]</tt>. This error is not included in the definition of <tt>⎕TRAP</tt> in <tt>goo</tt>, but rather  the Cutback <tt>⎕TRAP</tt> definition in <tt>foo</tt>. The error causes the stack to be cut back to <tt>foo</tt>, and then execution branches to <tt>foo[4]</tt>.  Thus <tt>⎕DMX.EN</tt> in <tt>foo</tt> retains the value set when the error occurred in <tt>goo</tt>. </p><pre>      foo 1
 Start foo  0
 End foo:  11
   </pre><p>In the second case a <tt>LENGTH ERROR</tt> (5) is raised on <tt>goo[2]</tt>.   This error is included in the definition of <tt>⎕TRAP</tt> in <tt>goo</tt> so the value <tt>⎕DMX.EN</tt> while in <tt>goo</tt> is 5, but when <tt>goo</tt> terminates and <tt>foo</tt> resumes execution the value of <tt>⎕DMX.EN</tt> localised in <tt>goo</tt> is lost.</p><pre>      foo 2
 Start foo  0
 goo:  5
 End foo:  0
</pre><p>In the third case a <tt>SYNTAX ERROR</tt> (2) is raised on <tt>goo[2]</tt>. Since the <tt>⎕TRAP</tt> statement is handled within <tt>goo</tt> (although the applicable <tt>⎕TRAP</tt> is defined in <tt>foo</tt>), the value <tt>⎕DMX.EN</tt> while in <tt>goo</tt> is 2, but when <tt>goo</tt> terminates and <tt>foo</tt> resumes execution the value of <tt>⎕DMX.EN</tt> localised in <tt>goo</tt> is lost.</p><pre>      foo 3
 Start foo  0
 goo:  2
 End foo:  0
</pre><script src="../../../help.js"></script></body>
</html>