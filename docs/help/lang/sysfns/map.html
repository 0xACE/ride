<!doctype html>
<html>
<head><meta charset="utf-8"><title></title><link rel="stylesheet" href="../../../help.css"></head>
<body><h2><tt>R←{X}⎕MAP Y</tt>Map File </h2><p><tt>⎕MAP</tt> function associates a mapped file with an APL array in the workspace.</p><p>Two types of mapped files are supported; <span class="Italic">APL</span> and <span class="Italic">raw</span>. An <span class="Italic">APL</span> mapped file contains the binary representation of a Dyalog APL array, including its header. A file of this type must be created using the supplied utility function <tt>∆MPUT</tt>. When you map an APL file, the rank, shape and data type of the array is obtained from the information on the file.</p><p>A <span class="Italic">raw</span> mapped file is an arbitrary collection of bytes. When you map a raw file, you must specify the characteristics of the APL array to be associated with this data. In particular, the data type and its shape.</p><p>The type of mapping is determined by the presence (raw) or absence (APL) of the left argument to <tt>⎕MAP</tt>.</p><p>The right argument <tt>Y</tt> specifies the name of the file to be mapped and, optionally, the access type and a start byte in the file. <tt>Y</tt> may be a simple character vector, or a 2 or 3-element nested vector containing:</p><ol><li value="1">file name (character scalar/vector)</li><li value="2">access code (character scalar/vector) : one of : <tt>'R'</tt> or <tt>'r'</tt> (read-only access) , <tt>'W'</tt> or <tt>'w'</tt> (read-write access).</li><li value="3">start byte offset (integer scalar/vector). Must be a multiple of 4 (default 0)</li></ol><p>If you map a file with read-only access you may modify the corresponding array in the workspace, however your changes are not written back to the file.</p><p>If <tt>X</tt> is specified, it defines the type and shape to be associated with <span class="Italic">raw</span> data on file. <tt>X</tt> must be an integer scalar or vector. The first item of <tt>X</tt> specifies the data type and must be one of the following values:</p><table><tr><td>Classic Edition</td><td>11, 82, 83, 163, 323 or 645</td></tr><tr><td>Unicode Edition</td><td>11, 80, 83, 160, 163, 320, 323 or 645</td></tr></table><p>The values are more fully explained in <a href="data-representation-monadic.html#DataRepresentation(Monadic)" class="MCXref_0">Data Representation (Monadic)</a>.</p><p>Following items determine the shape of the mapped array. A value of <tt>¯1</tt> on any (but normally the first) axis in the shape is replaced by the system to mean: read as many complete records from the file as possible. Only one axis may be specified in this way. Note that if    <tt>X</tt> is a singleton, the data on the file is mapped as a scalar and only the first value on the file is accessible.</p><p>If no left argument is given, file is assumed to contain a simple APL array, complete with header information (type, rank, shape, etc). Such mapped files may only be updated by changing the associated array using indexed/pick assignment: <tt>var[a]←b</tt>, the new values must be of the same type as the originals.</p><p>Note that a <span class="Italic">raw</span> mapped file may be updated <span class="Italic">only</span> if its <span class="Italic">file offset</span> is 0.</p><h4>Examples</h4><p>Map raw file as a read-only <span class="Italic">vector</span> of doubles:</p><pre>      vec←645 ¯1 ⎕MAP'c:\myfile'</pre><p>Map raw file as a 20-column read-write <span class="Italic">matrix</span> of 1-byte integers:</p><pre>      mat←83 ¯1 20 ⎕MAP'c:\myfile' 'W' </pre><p>Replace some items in mapped file:</p><pre>      mat[2 3;4 5]←2 2⍴⍳4</pre><p>Map bytes 100-180 in raw file as a 5×2 read-only matrix of doubles:</p><pre>      dat←645 5 2 ⎕MAP'c:\myfile' 'R' 100</pre><p>Put simple 4-byte integer array on disk ready for mapping:</p><pre>      (⊃83 323 ⎕DR 2 3 4⍴⍳24)∆MPUT'c:\myvar'</pre><p>Then, map a read-write variable:</p><pre>      var←⎕MAP'c:\myvar' 'w' </pre><p>Note that a mapped array need not be <span class="Italic">named</span>. In the following example, a ‘raw’ file is mapped, summed and released, all in a single expression:</p><pre>      +/163 ¯1 ⎕MAP'c:\shorts.dat'
42</pre><p>If you fail to specify the shape of the data, the data on file will be mapped as a scalar and only the first value in the file will be accessible:</p><pre>      83 ⎕MAP 'myfile'   ⍝ map FIRST BYTE of file.
¯86</pre><h4>Compatibility between Editions</h4><p>In the Unicode Edition <tt>⎕MAP</tt> will fail with a <tt>TRANSLATION ERROR</tt> (event number 92) if you attempt to map an APL file which contains character data type 82.</p><p>In order for the Unicode Edition to correctly interpret data in a raw file that was written using data type 82, the file may be mapped with data type 83 and the characters extracted by indexing into <tt>⎕AVU</tt>.</p><script src="../../../help.js"></script></body>
</html>