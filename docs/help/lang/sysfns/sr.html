<!doctype html>
<html>
<head><meta charset="utf-8"><title></title><link rel="stylesheet" href="../../../help.css"></head>
<body><h2><tt>R←{X}⎕SR Y</tt>Screen Read </h2><p><tt>⎕SR</tt> is a system function that allows the user to edit or otherwise interact with the form defined by <tt>⎕SM</tt>.</p><p>In versions of Dyalog APL that support asynchronous terminals, if the current screen is the SESSION screen, <tt>⎕SR</tt> immediately switches to the USER SCREEN and displays the form defined by <tt>⎕SM</tt>.</p><p>In Dyalog APL/X, <tt>⎕SR</tt> causes the input cursor to be positioned in the USER window.  During execution of <tt>⎕SR</tt>, only the USER Window defined by <tt>⎕SM</tt> will accept input and respond to the keyboard or mouse.  The SESSION and any EDIT and TRACE Windows that may appear on the display are dormant.</p><p>In versions of Dyalog APL with GUI support, a single SM object may be defined.  This object defines the size and position of the <tt>⎕SM</tt> window, and allows <tt>⎕SM</tt> to be used in conjunctions with other GUI components.  In these versions, <tt>⎕SR</tt> acts as a superset of <tt>⎕DQ</tt> (see <a href="dq.html#DequeueEvents" class="MCXref_0">Dequeue Events </a>) but additionally controls the character-based user interface defined by <tt>⎕SM</tt>.</p><p><tt>Y</tt> is an integer vector that specifies the fields which the user may visit.  In versions with GUI support, <tt>Y</tt> may additionally contain the names of GUI objects with which the user may also interact.</p><p>If specified, <tt>X</tt> may be an enclosed vector of character vectors defining <tt>EXIT_KEYS</tt> or a 2-element nested vector defining <tt>EXIT_KEYS</tt> and the <tt>INITIAL_CONTEXT</tt>.</p><p>The result <tt>R</tt> is the <tt>EXIT_CONTEXT</tt>.</p><p>Thus the 3 uses of <tt>⎕SR </tt>are:</p><pre>     EXIT_CONTEXT←⎕SR FIELDS
 
     EXIT_CONTEXT←(⊂EXIT_KEYS)⎕SR FIELDS
 
     EXIT_CONTEXT←(EXIT_KEYS)(INITIAL_CONTEXT)⎕SR FIELDS</pre><h4>FIELDS</h4><p>If an element of <tt>Y</tt> is an integer scalar, it specifies a field as the index of a row in <tt>⎕SM</tt> (if <tt>⎕SM</tt> is a vector it is regarded as having 1 row).</p><p>If an element of <tt>Y</tt> is an integer vector, it specifies a sub-field.  The first element in <tt>Y</tt> specifies the top-level field as above.  The next element is used to index a row in the form defined by <tt>⊃⎕SM[Y[1];1]</tt> and so forth.</p><p>If an element of <tt>Y</tt> is a character scalar or vector, it specifies the name of a top-level GUI object with which the user may also interact.  Such an object must be a "top-level" object, i.e. the <tt>Root</tt> object ('<tt>.'</tt>) or a <tt>Form</tt> or pop-up <tt>Menu</tt>.  This feature is implemented ONLY in versions of Dyalog APL with GUI support.</p><h4>EXIT_KEYS</h4><p>Each element of <tt>EXIT_KEYS</tt> is a 2-character code from the Input Translate Table for the keyboard.  If the user presses one of these keys, <tt>⎕SR</tt> will terminate and return a result.</p><p>If <tt>EXIT_KEYS</tt> is not specified, it defaults to:</p><pre>      'ER' 'EP' 'QT'</pre><p>which (normally) specifies &lt;Enter&gt;, &lt;Esc&gt; and &lt;Shift+Esc&gt;.</p><h4>INITIAL_CONTEXT</h4><p>This is a vector of between 3 and 6 elements with the following meanings and defaults:</p><table><tr><th class="Left">Element</th><th class="Left">Description</th><th class="Left">Default</th></tr><tr><td>1</td><td>Initial Field</td><td>N/A</td></tr><tr><td>2</td><td>Initial Cursor Position - Row</td><td>N/A</td></tr><tr><td>3</td><td>Initial Cursor Position - Col</td><td>N/A</td></tr><tr><td>4</td><td>Initial Keystroke</td><td><tt>''</tt></td></tr><tr><td>5</td><td>(ignored)</td><td>N/A</td></tr><tr><td>6</td><td>Changed Field Flags</td><td>0</td></tr></table><p>Structure of  INITIAL_CONTEXT</p><p><tt>INITIAL_CONTEXT[1]</tt> specifies the field in which the cursor is to be placed.  It is an integer scalar or vector, and must be a member of <tt>Y</tt>.  It must not specify a field which has <tt>BUTTON</tt> behaviour (64), as the cursor is not allowed to enter such a field.</p><p><tt>INITIAL_CONTEXT[2 3]</tt> are integer scalars which specify the initial cursor position within the field in terms of row and column numbers.</p><p><tt>INITIAL_CONTEXT[4]</tt> is either empty, or a 2-element character vector specifying the initial keystroke as a code from the Input Translate Table for the keyboard.</p><p><tt>INITIAL_CONTEXT[5]</tt> is ignored.  It is included so that the <tt>EXIT_CONTEXT</tt> result of one call to <tt>⎕SR</tt> can be used as the <tt>INITIAL_CONTEXT</tt> to a subsequent call.</p><p><tt>INITIAL_CONTEXT[6]</tt> is a Boolean scalar or vector the same length as <tt>Y</tt>.  It specifies which of the fields in <tt>Y</tt> has been modified by the user.</p><h4>EXIT_CONTEXT</h4><p>The result <tt>EXIT_CONTEXT</tt> is a 6 or 9-element vector whose first 6 elements have the same structure as the <tt>INITIAL_CONTEXT</tt>.  Elements 7-9 <b>only</b> apply to those versions of Dyalog APL that provide mouse support.</p><table><tr><th class="Left">Element</th><th class="Left">Description</th></tr><tr><td>1</td><td>Final Field</td></tr><tr><td>2</td><td>Final Cursor Position - Row</td></tr><tr><td>3</td><td>Final Cursor Position - Col</td></tr><tr><td>4</td><td>Terminating Keystroke</td></tr><tr><td>5</td><td>Event Code</td></tr><tr><td>6</td><td>Changed Field Flags</td></tr><tr><td>7</td><td>Pointer Field</td></tr><tr><td>8</td><td>Pointer Position - Row</td></tr><tr><td>9</td><td>Pointer Position - Col</td></tr></table><p>Structure of the Result of <tt>⎕SR</tt></p><p><tt>EXIT_CONTEXT[1]</tt> contains the field in which the cursor was when <tt>⎕SR</tt> terminated due to the user pressing an exit key or due to an event occurring.  It is an integer scalar or vector, and a member of <tt>Y</tt>.</p><p><tt>EXIT_CONTEXT[2 3]</tt> are integer scalars which specify the row and column position of the cursor within the field <tt>EXIT_CONTEXT[1]</tt> when <tt>⎕SR</tt> terminated.</p><p><tt>EXIT_CONTEXT[4]</tt> is a 2-element character vector specifying the last keystroke pressed by the user before <tt>⎕SR</tt> terminated.  Unless <tt>⎕SR</tt> terminated due to an event, <tt>EXIT_CONTEXT[4]</tt> will contain one of the exit keys defined by <tt>X</tt>.  The keystroke is defined in terms of an Input Translate Table code.</p><p><tt>EXIT_CONTEXT[5]</tt> contains the <b>sum</b> of the event codes that caused <tt>⎕SR</tt> to terminate.  For example, if the user pressed a mouse button on a <tt>BUTTON</tt> field (event code 64) <b>and</b> the current field has <tt>MODIFIED</tt> behaviour (event code 2) <tt>EXIT_CONTEXT[5]</tt> will have the value 66.</p><p><tt>EXIT_CONTEXT[6]</tt> is a Boolean scalar or vector the same length as <tt>Y</tt>.  It specifies which of the fields in <tt>Y</tt> has been modified by the user during <b>this </b><tt>⎕SR</tt>, ORed with <tt>INITIAL_CONTEXT[6]</tt>.  Thus if the <tt>EXIT_CONTEXT</tt> of one call to <tt>⎕SR</tt> is fed back as the <tt>INITIAL_CONTEXT</tt> of the next, <tt>EXIT_CONTEXT[6]</tt> records the fields changed since the start of the process.</p><h4>EXIT_CONTEXT (Window Versions)</h4><p><tt>⎕SR</tt> returns a 9-element result <b>ONLY</b> if it is terminated by the user pressing a mouse button.  In this case:</p><p><tt>EXIT_CONTEXT[7]</tt> contains the field over which the mouse pointer was positioned when the user pressed a button. It is an integer scalar or vector, and a member of <tt>Y</tt>.</p><p><tt>EXIT_CONTEXT[8 9]</tt> are integer scalars which specify the row and column position of the mouse pointer within the field <tt>EXIT_CONTEXT[7]</tt> when <tt>⎕SR</tt> terminated.</p></body>
</html>