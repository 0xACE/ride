<!doctype html>
<html>
<head><meta charset="utf-8"><title></title><link rel="stylesheet" href="../../../help.css"></head>
<body><h2><tt>{R}←⎕DQ Y</tt>Dequeue Events </h2><p><tt>⎕DQ</tt> awaits and processes events.  <tt>Y</tt> specifies the GUI objects(s) for which events are to be processed.  Objects are identified by their names, as character scalars/vectors, or by namespace references. These may be objects of type Root, Form, Locator, Filebox, MsgBox, PropertySheet, TCPSocket, Timer, Clipboard  and pop-up Menu.  Sub-objects (children) of those named in <tt>Y</tt> are also included.  However, any objects which exist, but are not named in <tt>Y</tt>, are effectively disabled (do not respond to the user).</p><p>If <tt>Y</tt> is <tt>'.'</tt>, all objects currently owned and subsequently created by the current thread are included in the <tt>⎕DQ</tt>. Note that because the Root object is owned by thread 0, events on Root are reported only to thread 0.</p><p>If <tt>Y</tt> is empty it specifies the object associated with the current namespace and is only valid if the current space is one of the objects listed above.</p><p>Otherwise, <tt>Y</tt> contains the name(s) of or reference(s) to the objects for which events are to be processed.  Effectively, this is the list of objects with which the user may interact.  A <tt>DOMAIN ERROR</tt> is reported if an element of <tt>Y</tt> refers to anything other than an existing "top-level" object.</p><p>Associated with every object is a set of events.  For every event there is defined an "action" which specifies how that event is to be processed by <tt>⎕DQ</tt>.  The "action" may be a number with the value <tt>0</tt>, <tt>1</tt> or <tt>¯1</tt>, or a character vector containing the name of a "callback function", or a character vector containing the name of a callback function coupled with an arbitrary array.  Actions can be defined in a number of ways, but the following examples will illustrate the different cases.</p><p class="pagebreakafter"> </p><pre>      OBJ ⎕WS 'Event' 'Select' 0
 
      OBJ ⎕WS 'Event' 'Select' 1
 
      OBJ ⎕WS 'Event' 'Select' 'FOO'
 
      OBJ ⎕WS 'Event' 'Select' 'FOO' 10
 
      OBJ ⎕WS 'Event' 'Select' 'FOO&amp;'</pre><p>These are treated as follows:</p><h4>Action = 0 (the default)</h4><p><tt>⎕DQ</tt> performs "standard" processing appropriate to the object and type of event.  For example, the standard processing for a KeyPress event in an Edit object is to action the key press, i.e. to echo the character on the screen.</p><h4>Action = <tt>¯</tt>1</h4><p>This disables the event.  The "standard" processing appropriate to the object and type of event is <b>not </b>performed, or in some cases is reversed.  For example, if the "action code" for a KeyPress event (22) is set to <tt>¯1</tt>,  <tt>⎕DQ</tt> simply ignores all keystrokes for the object in question. </p><h4>Action = 1</h4><p><tt>⎕DQ</tt> terminates and returns information pertaining to the event (the <b>event message</b> in <tt>R</tt> as a nested vector whose first two elements are the name of the object (that generated the event) and the event code.  <tt>R</tt> may contain additional elements depending upon the type of event that occurred.</p><h4>Action = fn {larg}</h4><p><tt>fn</tt> is a character vector containing the name of a <span class="Italic">callback</span> function.  This function is automatically invoked by <tt>⎕DQ</tt> whenever the event occurs, and <b>prior </b>to the standard processing for the event.  The callback is supplied the <b>event message</b> (see above) as its right argument, and, if specified, the array <tt>larg</tt> as its left argument.  If the callback function fails to return a result, or returns the scalar value 1,  <tt>⎕DQ</tt> then performs the standard processing appropriate to the object and type of event.  If the callback function returns a scalar 0, the standard processing is not performed or in some cases is reversed. </p><p>If the callback function returns its event message with some of the parameters changed, these changes are incorporated into the standard processing.  An example would be the processing of a keystroke message where the callback function substitutes upper case for lower case characters. The exact nature of this processing is described in the reference section on each event type.</p><h4>Action = <tt>⍎</tt>expr</h4><p>If <tt>Action</tt> is set to a character vector whose first element is the execute symbol (<tt>⍎</tt>) the remaining string will be executed automatically whenever the event occurs.  The default processing for the event is performed first and may not be changed or inhibited in any way. </p><h4>Action = fn&amp; {larg}</h4><p><tt>fn</tt> is a character vector containing the name of a <span class="Italic">callback</span> function.  The function is executed in a new thread. The default processing for the event is performed first and may not be changed or inhibited in any way. </p><h4>The Result of <tt>⎕DQ</tt></h4><p><tt>⎕DQ</tt> terminates, returning the shy result <tt>R</tt>, in one of four instances. </p><p>Firstly, <tt>⎕DQ</tt> terminates when an event occurs whose "action code" is 1.  In this case, its result is a nested vector containing the <b>event message</b> associated with the event.  The structure of an event message varies according to the event type (see <span class="Italic">Object Reference</span>).  However, an event message has at least two elements of which the first is a ref to the object or a character vector containing the name of the object, and the second is a numeric code specifying the event type.</p><p><tt>⎕DQ</tt> also terminates if all of the objects named in <tt>Y</tt> have been deleted.  In this case, the result is an empty character vector.  Objects are deleted either using <tt>⎕EX</tt>, or on exit from a defined function or operator if the names are localised in the header, or on closing a form using the system menu.</p><p>Thirdly, <tt>⎕DQ</tt> terminates if the object named in its right argument is a special <span class="Italic">modal</span> object, such as a <tt>MsgBox</tt>, <tt>FileBox</tt> or <tt>Locator</tt>, and the user has finished interacting with the object (e.g. by pressing an "OK" button).  The return value of <tt>⎕DQ</tt> in this case depends on the action code of the event.</p><p>Finally, <tt>⎕DQ</tt> terminates with a <tt>VALUE ERROR</tt> if it attempts to execute a callback function that is undefined.</p></body>
</html>