<!doctype html>
<html>
<head><meta charset="utf-8"><title></title><link rel="stylesheet" href="../../../help.css"></head>
<body><h2><tt>⎕TRAP</tt>Trap Event </h2><p>This is a non-simple vector.  An item of <tt>⎕TRAP</tt> specifies an action to be taken when one of a set of events occurs.  An item of <tt>⎕TRAP</tt> is a 2 or 3 element vector whose items are simple scalars or vectors in the following order:</p><ol><li value="1">an integer vector whose value is one or more event codes selected from the list in the Figure on the following two pages.</li><li value="2">a character scalar whose value is an action code selected from the letters <tt>C</tt>, <tt>E</tt>, <tt>N</tt> or <tt>S</tt>.</li><li value="3">if element 2 is the letter <tt>C</tt> or <tt>E</tt>, this item is a character vector forming a valid APL expression or series of expressions separated by <tt>⋄</tt>.  Otherwise, this element is omitted.</li></ol><p>An EVENT may be an APL execution error, an interrupt by the user or the system, a control interrupt caused by the <tt>⎕STOP</tt> system function, or an event generated by the <tt>⎕SIGNAL</tt> system function.</p><p>When an event occurs, the system searches for a trap definition for that event.  The most local <tt>⎕TRAP</tt> value is searched first, followed by successive shadowed values of <tt>⎕TRAP</tt>, and finally the global <tt>⎕TRAP</tt> value.  Separate actions defined in a single <tt>⎕TRAP</tt> value are searched from <b>left to right</b>.  If a trap definition for the event is found, the defined action is taken.  Otherwise, the normal system action is followed.</p><p>The ACTION code identifies the nature of the action to be taken when an associated event occurs.  Permitted codes are interpreted as follows:</p><table><tbody><tr><td><tt>C</tt></td><td> Cutback</td><td>The state indicator is 'cut back' to the environment in which the <tt>⎕TRAP</tt> is locally defined (or to immediate execution level).  The APL expression in element 3 of the same <tt>⎕TRAP</tt> item is then executed.</td></tr><tr><td><tt>E</tt></td><td>Execute</td><td> The APL expression in element 3 of the same <tt>⎕TRAP</tt> item is executed in the environment in which the event occurred.</td></tr><tr><td><tt>N</tt></td><td>Next</td><td> The event is excluded from the current <tt>⎕TRAP</tt> definition.  The search will continue through further localised definitions of <tt>⎕TRAP</tt></td></tr><tr><td><tt>S</tt></td><td>Stop</td><td>    Stops the search and causes the normal APL action to be taken in the environment in which the event occurred.</td></tr></tbody></table><p class="TableCaption"><span class="autonumber"><span>Table 22: </span></span><a name="TrapEvents"></a> Trappable Event Codes </p><table><tr><th class="Left">Code</th><th class="Left">Event</th></tr><tr><td><tt>0</tt></td><td><tt><b>Any event</b> in range 1-999</tt></td></tr><tr><td><tt>1</tt></td><td><tt>WS FULL</tt></td></tr><tr><td><tt>2</tt></td><td><tt>SYNTAX ERROR</tt></td></tr><tr><td><tt>3</tt></td><td><tt>INDEX ERROR</tt></td></tr><tr><td><tt>4</tt></td><td><tt>RANK ERROR</tt></td></tr><tr><td><tt>5</tt></td><td><tt>LENGTH ERROR</tt></td></tr><tr><td><tt>6</tt></td><td><tt>VALUE ERROR</tt></td></tr><tr><td><tt>7</tt></td><td><tt>FORMAT ERROR</tt></td></tr><tr><td><tt>10</tt></td><td><tt>LIMIT ERROR</tt></td></tr><tr><td><tt>11</tt></td><td><tt>DOMAIN ERROR</tt></td></tr><tr><td><tt>12</tt></td><td><tt>HOLD ERROR</tt></td></tr><tr><td><tt>16</tt></td><td><tt>NONCE ERROR</tt></td></tr><tr><td><tt>18</tt></td><td><tt>FILE TIE ERROR</tt></td></tr><tr><td><tt>19</tt></td><td><tt>FILE ACCESS ERROR</tt></td></tr><tr><td><tt>20</tt></td><td><tt>FILE INDEX ERROR</tt></td></tr><tr><td><tt>21</tt></td><td><tt>FILE FULL</tt></td></tr><tr><td><tt>22</tt></td><td><tt>FILE NAME ERROR</tt></td></tr><tr><td><tt>23</tt></td><td><tt>FILE DAMAGED</tt></td></tr><tr><td><tt>24</tt></td><td><tt>FILE TIED</tt></td></tr><tr><td><tt>25</tt></td><td><tt>FILE TIED REMOTELY</tt></td></tr><tr><td><tt>26</tt></td><td><tt>FILE SYSTEM ERROR</tt></td></tr><tr><td><tt>28</tt></td><td><tt>FILE SYSTEM NOT AVAILABLE</tt></td></tr><tr><td><tt>30</tt></td><td><tt>FILE SYSTEM TIES USED UP</tt></td></tr><tr><td><tt>31</tt></td><td><tt>FILE TIE QUOTA USED UP</tt></td></tr><tr><td><tt>32</tt></td><td><tt>FILE NAME QUOTA USED UP</tt></td></tr><tr><td><tt>34</tt></td><td><tt>FILE SYSTEM NO SPACE</tt></td></tr><tr><td><tt>35</tt></td><td><tt>FILE ACCESS ERROR - CONVERTING FILE</tt></td></tr><tr><td><tt>38</tt></td><td><tt>FILE COMPONENT DAMAGED</tt></td></tr><tr><td><tt>52</tt></td><td><tt>FIELD CONTENTS RANK ERROR</tt></td></tr><tr><td><tt>53</tt></td><td><tt>FIELD CONTENTS TOO MANY COLUMNS</tt></td></tr><tr><td><tt>54</tt></td><td><tt>FIELD POSITION ERROR</tt></td></tr><tr><td><tt>55</tt></td><td><tt>FIELD SIZE ERROR</tt></td></tr><tr><td><tt>56</tt></td><td><tt>FIELD CONTENTS/TYPE MISMATCH</tt></td></tr><tr><td><tt>57</tt></td><td><tt>FIELD TYPE/BEHAVIOUR UNRECOGNISED</tt></td></tr><tr><td><tt>58</tt></td><td><tt>FIELD ATTRIBUTES RANK ERROR</tt></td></tr><tr><td><tt>59</tt></td><td><tt>FIELD ATTRIBUTES LENGTH ERROR</tt></td></tr><tr><td><tt>60</tt></td><td><tt>FULL-SCREEN ERROR</tt></td></tr><tr><td><tt>61</tt></td><td><tt>KEY CODE UNRECOGNISED</tt></td></tr><tr><td><tt>62</tt></td><td><tt>KEY CODE RANK ERROR</tt></td></tr><tr><td><tt>63</tt></td><td><tt>KEY CODE TYPE ERROR</tt></td></tr><tr><td><tt>70</tt></td><td><tt>FORMAT FILE ACCESS ERROR</tt></td></tr><tr><td><tt>71</tt></td><td><tt>FORMAT FILE ERROR</tt></td></tr><tr><td><tt>72</tt></td><td><tt>NO PIPES</tt></td></tr><tr><td><tt>76</tt></td><td><tt>PROCESSOR TABLE FULL</tt></td></tr><tr><td><tt>84</tt></td><td><tt>TRAP ERROR</tt></td></tr><tr><td><tt>90</tt></td><td><tt>EXCEPTION</tt></td></tr><tr><td><tt>92</tt></td><td><tt>TRANSLATION ERROR</tt></td></tr><tr><td><tt> </tt></td><td><tt> </tt></td></tr><tr><td><tt>200-499</tt></td><td><tt>Reserved for distributed auxiliary processors</tt></td></tr><tr><td><tt> </tt></td><td><tt> </tt></td></tr><tr><td><tt>500-999</tt></td><td><tt>User-defined events</tt></td></tr><tr><td><tt> </tt></td><td><tt> </tt></td></tr><tr><td><tt>1000</tt></td><td><tt><b>Any event</b> in range 1001-1008</tt></td></tr><tr><td><tt>1001</tt></td><td><tt>Stop vector</tt></td></tr><tr><td><tt>1002</tt></td><td><tt>Weak interrupt</tt></td></tr><tr><td><tt>1003</tt></td><td><tt>INTERRUPT</tt></td></tr><tr><td><tt>1005</tt></td><td><tt>EOF INTERRUPT</tt></td></tr><tr><td><tt>1006</tt></td><td><tt>TIMEOUT</tt></td></tr><tr><td><tt>1007</tt></td><td><tt>RESIZE (Dyalog APL/X, Dyalog APL/W)</tt></td></tr><tr><td><tt>1008</tt></td><td><tt>DEADLOCK</tt></td></tr></table><p>See <a href="../control-structures/trap.html#TrapStatement" class="MCXref_0">Trap Statement</a> for an alternative 'control structured' error trapping mechanism.</p><h4>Examples</h4><pre>      ⎕TRAP←⊂(3 4 5) 'E' 'ERROR' ⋄ ⍴⎕TRAP
1
 
      ⎕TRAP
  3 4 5 E ERROR</pre><p>Items may be specified as scalars.  If there is only a single trap definition, it need not be enclosed.  However, the value of <tt>⎕TRAP</tt> will be rigorously correct:</p><pre>      ⎕TRAP←11 'E' '→LAB'
 
      ⎕TRAP
  11 E →ERR
 
      ⍴⎕TRAP
1</pre><p>The value of <tt>⎕TRAP</tt> in a clear workspace is an empty vector whose prototype is </p><p><tt>0⍴(⍬ '' '')</tt>.  A convenient way of cancelling a <tt>⎕TRAP</tt> definition is:</p><pre>      ⎕TRAP←0⍴⎕TRAP</pre><p>Event codes 0 and 1000 allow all events in the respective ranges 1-999 and 1000-1006 to be trapped.  Specific event codes may be excluded by the <tt>N</tt> action (which must precede the general event action):</p><pre>      ⎕TRAP←(1 'N')(0 'E' '→GENERR')</pre><p>The 'stop' action is a useful mechanism for cancelling trap definitions during development of applications.</p><p>The 'cut-back' action is useful for returning control to a known point in the application system when errors occur.  The following example shows a function that selects and executes an option with a general trap to return control to the function when an untrapped event occurs:</p><pre> 
     ∇ SELECT;OPT;⎕TRAP
[1]   ⍝ Option selection and execution
[2]   ⍝ A general cut-back trap
[3]    ⎕TRAP←(0 1000)'C' '→ERR'
[4]   INP:⍞←'OPTION : ' ⋄ OPT←(OPT≠' ')/OPT←9↓⍞
[5]    →EX⍴⍨(⊂OPT)∊Options ⋄ 'INVALID OPTION' ⋄ →INP
[6]   EX:⍎OPT ⋄ →INP
[7]   ERR:ERROR∆ACTION ⋄ →INP
[8]   END:
     ∇</pre><p>User-defined events may be signalled through the <tt>⎕SIGNAL</tt> system function.  A user-defined event (in the range 500-999) may be trapped explicitly or implicitly by the event code 0.</p><h4>Example</h4><pre>      ⎕TRAP←500 'E' '''USER EVENT 500 - TRAPPED'''
 
      ⎕SIGNAL 500
USER EVENT 500 - TRAPPED</pre><p> </p></body>
</html>