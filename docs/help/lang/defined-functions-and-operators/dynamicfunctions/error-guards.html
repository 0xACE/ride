<!doctype html>
<html>
<head><meta charset="utf-8"><title></title><link rel="stylesheet" href="../../../../help.css"></head>
<body><h3><a name="ErrorGuards"></a>Error-Guards</h3><p>An <b>error-guard</b> is (an expression that evaluates to) a vector of error numbers, followed by the digraph: <tt>::</tt>, followed by an expression, the <span class="Italic">body</span> of the guard, to be evaluated as the result of the function. For example:</p><pre>      11 5 :: ⍵×0 ⍝ Trap DOMAIN and LENGTH errors.</pre><p>In common with <tt>:Trap</tt> and <tt>⎕TRAP</tt>, error numbers 0 and 1000 are catchalls for synchronous errors and interrupts respectively.</p><p>When an error is generated, the system searches statically upwards and outwards for an error-guard that matches the error. If one is found, the execution environment is unwound to its state immediately <span class="Italic">prior</span> to the error-guard’s execution and the body of the error-guard is evaluated as the result of the function. This means that, during evaluation of the body, the guard is no longer in effect and so the danger of a hang caused by an infinite ‘trap loop’, is avoided.</p><p>Notice that you can provide ‘cascading’ error trapping in the following way:</p><pre>0::try_2nd
0::try_1st
   expr</pre><p>In this case, if <tt>exp</tt>r generates an error, its immediately preceding: <tt>0::</tt> catches it and evaluates <tt>try_1st</tt> leaving the remaining error-guard in scope. If <tt>try_1st</tt> fails, the environment is unwound once again and <tt>try_2nd</tt> is evaluated, this time with no error-guards in scope.</p><h4>Examples:</h4><p><tt>Open</tt> returns a handle for a component file. If the exclusive tie fails, it attempts a share-tie and if this fails, it creates a new file. Finally, if all else fails, a handle of 0 is returned.</p><pre>open←{                 ⍝ Handle for component file ⍵.
    0::0               ⍝ Fails:: return 0 handle.
    22::⍵ ⎕FCREATE 0   ⍝ FILE NAME:: create new one.
    24 25::⍵ ⎕FSTIE 0  ⍝ FILE TIED:: try share tie.
           ⍵ ⎕FTIE 0   ⍝ Attempt to open file.
}</pre><p>An error in <tt>div</tt> causes it to be called recursively with <span class="Italic">improved</span> arguments.</p><pre>div←{                  ⍝ Tolerant division:: ⍺÷0 → ⍺.
    ⍺←1                ⍝ default numerator.
    5::↑∇/↓↑⍺ ⍵        ⍝ LENGTH:: stretch to fit.
    11::⍺ ∇ ⍵+⍵=0      ⍝ DOMAIN:: increase divisor.
    ⍺÷⍵                ⍝ attempt division.
}</pre><p>Notice that some arguments may cause <tt>div</tt> to recur twice:</p><pre>       6 4 2 div 3 2
→      6 4 2 div 3 2 0
→      6 4 2 div 3 2 1
→      2 2 2</pre><p>The final example shows the unwinding of the local environment before the error-guard’s body is evaluated. Local name <tt>trap</tt> is set to describe the domain of its following error-guard. When an error occurs, the environment is unwound to expose <tt>trap</tt>’s statically correct value.</p><pre>      add←{
          trap←'domain' ⋄ 11::trap
          trap←'length' ⋄  5::trap
          ⍺+⍵
      }
 
      2 add 3         ⍝ Addition succeeds 
5
 
      2 add 'three'   ⍝ DOMAIN ERROR generated.
domain
 
      2 3 add 4 5 6   ⍝ LENGTH ERROR generated.
length</pre><script src="../../../../help.js"></script></body>
</html>